!function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,r){!function(e,t){if(!x[e]||!A[e])return;for(var r in A[e]=!1,t)Object.prototype.hasOwnProperty.call(t,r)&&(g[r]=t[r]);0==--y&&0===v&&T()}(e,r),t&&t(e,r)};var r,i=!0,o="1d0a238f0895448fbb2d",n=1e4,s={},a=[],l=[];function d(e){var t=w[e];if(!t)return V;var i=function(i){return t.hot.active?(w[i]?-1===w[i].parents.indexOf(e)&&w[i].parents.push(e):(a=[e],r=i),-1===t.children.indexOf(i)&&t.children.push(i)):(console.warn("[HMR] unexpected require("+i+") from disposed module "+e),a=[]),V(i)},o=function(e){return{configurable:!0,enumerable:!0,get:function(){return V[e]},set:function(t){V[e]=t}}};for(var n in V)Object.prototype.hasOwnProperty.call(V,n)&&"e"!==n&&"t"!==n&&Object.defineProperty(i,n,o(n));return i.e=function(e){return"ready"===h&&p("prepare"),v++,V.e(e).then(t,function(e){throw t(),e});function t(){v--,"prepare"===h&&(E[e]||C(e),0===v&&0===y&&T())}},i.t=function(e,t){return 1&t&&(e=i(e)),V.t(e,-2&t)},i}function c(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:r!==e,active:!0,accept:function(e,r){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var i=0;i<e.length;i++)t._acceptedDependencies[e[i]]=r||function(){};else t._acceptedDependencies[e]=r||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._declinedDependencies[e[r]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);r>=0&&t._disposeHandlers.splice(r,1)},check:_,apply:S,status:function(e){if(!e)return h;u.push(e)},addStatusHandler:function(e){u.push(e)},removeStatusHandler:function(e){var t=u.indexOf(e);t>=0&&u.splice(t,1)},data:s[e]};return r=void 0,t}var u=[],h="idle";function p(e){h=e;for(var t=0;t<u.length;t++)u[t].call(null,e)}var f,g,m,y=0,v=0,E={},A={},x={};function b(e){return+e+""===e?+e:e}function _(e){if("idle"!==h)throw new Error("check() is only allowed in idle status");return i=e,p("check"),(t=n,t=t||1e4,new Promise(function(e,r){if("undefined"==typeof XMLHttpRequest)return r(new Error("No browser support"));try{var i=new XMLHttpRequest,n=V.p+""+o+".hot-update.json";i.open("GET",n,!0),i.timeout=t,i.send(null)}catch(e){return r(e)}i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)r(new Error("Manifest request to "+n+" timed out."));else if(404===i.status)e();else if(200!==i.status&&304!==i.status)r(new Error("Manifest request to "+n+" failed."));else{try{var t=JSON.parse(i.responseText)}catch(e){return void r(e)}e(t)}}})).then(function(e){if(!e)return p("idle"),null;A={},E={},x=e.c,m=e.h,p("prepare");var t=new Promise(function(e,t){f={resolve:e,reject:t}});g={};return C(0),"prepare"===h&&0===v&&0===y&&T(),t});var t}function C(e){x[e]?(A[e]=!0,y++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=V.p+""+e+"."+o+".hot-update.js",document.head.appendChild(t)}(e)):E[e]=!0}function T(){p("ready");var e=f;if(f=null,e)if(i)Promise.resolve().then(function(){return S(i)}).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var r in g)Object.prototype.hasOwnProperty.call(g,r)&&t.push(b(r));e.resolve(t)}}function S(t){if("ready"!==h)throw new Error("apply() is only allowed in ready status");var r,i,n,l,d;function c(e){for(var t=[e],r={},i=t.slice().map(function(e){return{chain:[e],id:e}});i.length>0;){var o=i.pop(),n=o.id,s=o.chain;if((l=w[n])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:s,moduleId:n};if(l.hot._main)return{type:"unaccepted",chain:s,moduleId:n};for(var a=0;a<l.parents.length;a++){var d=l.parents[a],c=w[d];if(c){if(c.hot._declinedDependencies[n])return{type:"declined",chain:s.concat([d]),moduleId:n,parentId:d};-1===t.indexOf(d)&&(c.hot._acceptedDependencies[n]?(r[d]||(r[d]=[]),u(r[d],[n])):(delete r[d],t.push(d),i.push({chain:s.concat([d]),id:d})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:r}}function u(e,t){for(var r=0;r<t.length;r++){var i=t[r];-1===e.indexOf(i)&&e.push(i)}}t=t||{};var f={},y=[],v={},E=function(){console.warn("[HMR] unexpected require("+_.moduleId+") to disposed module")};for(var A in g)if(Object.prototype.hasOwnProperty.call(g,A)){var _;d=b(A);var C=!1,T=!1,S=!1,R="";switch((_=g[A]?c(d):{type:"disposed",moduleId:A}).chain&&(R="\nUpdate propagation: "+_.chain.join(" -> ")),_.type){case"self-declined":t.onDeclined&&t.onDeclined(_),t.ignoreDeclined||(C=new Error("Aborted because of self decline: "+_.moduleId+R));break;case"declined":t.onDeclined&&t.onDeclined(_),t.ignoreDeclined||(C=new Error("Aborted because of declined dependency: "+_.moduleId+" in "+_.parentId+R));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(_),t.ignoreUnaccepted||(C=new Error("Aborted because "+d+" is not accepted"+R));break;case"accepted":t.onAccepted&&t.onAccepted(_),T=!0;break;case"disposed":t.onDisposed&&t.onDisposed(_),S=!0;break;default:throw new Error("Unexception type "+_.type)}if(C)return p("abort"),Promise.reject(C);if(T)for(d in v[d]=g[d],u(y,_.outdatedModules),_.outdatedDependencies)Object.prototype.hasOwnProperty.call(_.outdatedDependencies,d)&&(f[d]||(f[d]=[]),u(f[d],_.outdatedDependencies[d]));S&&(u(y,[_.moduleId]),v[d]=E)}var O,z=[];for(i=0;i<y.length;i++)d=y[i],w[d]&&w[d].hot._selfAccepted&&z.push({module:d,errorHandler:w[d].hot._selfAccepted});p("dispose"),Object.keys(x).forEach(function(e){!1===x[e]&&function(e){delete installedChunks[e]}(e)});for(var P,M,N=y.slice();N.length>0;)if(d=N.pop(),l=w[d]){var k={},H=l.hot._disposeHandlers;for(n=0;n<H.length;n++)(r=H[n])(k);for(s[d]=k,l.hot.active=!1,delete w[d],delete f[d],n=0;n<l.children.length;n++){var D=w[l.children[n]];D&&((O=D.parents.indexOf(d))>=0&&D.parents.splice(O,1))}}for(d in f)if(Object.prototype.hasOwnProperty.call(f,d)&&(l=w[d]))for(M=f[d],n=0;n<M.length;n++)P=M[n],(O=l.children.indexOf(P))>=0&&l.children.splice(O,1);for(d in p("apply"),o=m,v)Object.prototype.hasOwnProperty.call(v,d)&&(e[d]=v[d]);var I=null;for(d in f)if(Object.prototype.hasOwnProperty.call(f,d)&&(l=w[d])){M=f[d];var L=[];for(i=0;i<M.length;i++)if(P=M[i],r=l.hot._acceptedDependencies[P]){if(-1!==L.indexOf(r))continue;L.push(r)}for(i=0;i<L.length;i++){r=L[i];try{r(M)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:d,dependencyId:M[i],error:e}),t.ignoreErrored||I||(I=e)}}}for(i=0;i<z.length;i++){var F=z[i];d=F.module,a=[d];try{V(d)}catch(e){if("function"==typeof F.errorHandler)try{F.errorHandler(e)}catch(r){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:d,error:r,originalError:e}),t.ignoreErrored||I||(I=r),I||(I=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:d,error:e}),t.ignoreErrored||I||(I=e)}}return I?(p("fail"),Promise.reject(I)):(p("idle"),new Promise(function(e){e(y)}))}var w={};function V(t){if(w[t])return w[t].exports;var r=w[t]={i:t,l:!1,exports:{},hot:c(t),parents:(l=a,a=[],l),children:[]};return e[t].call(r.exports,r,r.exports,d(t)),r.l=!0,r.exports}V.m=e,V.c=w,V.d=function(e,t,r){V.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},V.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},V.t=function(e,t){if(1&t&&(e=V(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(V.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)V.d(r,i,function(t){return e[t]}.bind(null,i));return r},V.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return V.d(t,"a",t),t},V.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},V.p="",V.h=function(){return o},d(0)(V.s=0)}([function(e,t,r){var i;(i=r(1)).keys().forEach(i),r(7),r(9)},function(e,t,r){var i={"./environment.js":2,"./noiseShader.js":3,"./spin.js":6};function o(e){var t=n(e);return r(t)}function n(e){if(!r.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=n,e.exports=o,o.id=1},function(e,t,r){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var i=["none","cubes","pyramids","cylinders","hexagons","stones","trees","mushrooms","towers","apparatus","arches","torii","grass","islands"];AFRAME.registerComponent("environment",{schema:{active:{default:!1},preset:{default:"default",oneOf:["none","default","contact","egypt","checkerboard","forest","goaland","yavapai","goldmine","arches","threetowers","poison","tron","japan","dream","volcano","starry","osiris"]},seed:{type:"string"},skyType:{default:"color",oneOf:["none","color","gradient","atmosphere"]},skyColor:{type:"color"},horizonColor:{type:"color"},lighting:{default:"distant",oneOf:["none","distant","point"]},shadow:{default:!1},shadowSize:{default:10},lightPosition:{type:"vec3",default:{x:0,y:1,z:-.2}},fog:{type:"float",default:0,min:0,max:1},flatShading:{default:!1},playArea:{type:"float",default:1.5,min:.5,max:10},ground:{default:"hills",oneOf:["none","flat","hills","canyon","spikes","noise"]},groundYScale:{type:"float",default:20,min:0,max:50},groundTexture:{default:"none",oneOf:["none","checkerboard","squares","walkernoise"]},groundColor:{type:"color",default:"#553e35"},groundColor2:{type:"color",default:"#694439"},dressing1:{default:"none",oneOf:i},dressing1Amount:{type:"int",default:10,min:0,max:1e3},dressing1Color:{type:"color",default:"#795449"},dressing1Scale:{type:"float",default:5,min:0,max:100},dressing1Variance:{type:"vec3",default:{x:1,y:1,z:1}},dressing1UniformScale:{default:!1},dressing1OnPlayArea:{type:"float",default:0,min:0,max:1},dressing2:{default:"none",oneOf:i},dressing2Amount:{type:"int",default:10,min:0,max:1e3},dressing2Color:{type:"color",default:"#795449"},dressing2Scale:{type:"float",default:5,min:0,max:100},dressing2Variance:{type:"vec3",default:{x:1,y:1,z:1}},dressing2UniformScale:{default:!1},dressing2OnPlayArea:{type:"float",default:0,min:0,max:1},grid:{default:"none",oneOf:["none","1x1","2x2","crosses","dots","xlines","ylines"]},gridColor:{type:"color",default:"#ccc"},varyColor:{default:!0}},multiple:!1,presets:{none:{},default:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:1,z:.33},fog:.78,flatShading:!1,playArea:1.5,ground:"hills",groundYScale:3,groundTexture:"checkerboard",groundColor:"#454545",groundColor2:"#5d5d5d",dressing1:"none",dressing1Amount:10,dressing1Color:"#795449",dressing1Scale:1,dressing1Variance:{x:0,y:0,z:0},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"none",gridColor:"#ccc",shadow:!1},contact:{dressing2:"apparatus",dressing2Amount:10,dressing2Color:"#657067",dressing2Scale:2,dressing2Variance:{x:10,y:10,z:10},dressing2UniformScale:!0,dressing2OnPlayArea:.8,active:!0,seed:14,skyType:"gradient",skyColor:"#478d54",horizonColor:"#b696cb",lighting:"distant",lightPosition:{x:0,y:2.01,z:-1},fog:.64,flatShading:!1,playArea:1.5,ground:"spikes",groundYScale:100,groundTexture:"none",groundColor:"#2e455f",groundColor2:"#694439",dressing1:"apparatus",dressing1Amount:30,dressing1Color:"#657067",dressing1Scale:20,dressing1Variance:{x:20,y:20,z:20},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"1x1",gridColor:"#478d54",shadow:!1},egypt:{dressing2:"stones",dressing2Amount:200,dressing2Color:"#99694f",dressing2Scale:.26,dressing2Variance:{x:.2,y:.2,z:.2},dressing2UniformScale:!1,dressing2OnPlayArea:.8,active:!0,seed:26,skyType:"gradient",skyColor:"#1b7660",horizonColor:"#e4b676",lighting:"distant",lightPosition:{x:0,y:1.65,z:-1},fog:.75,flatShading:!1,playArea:1.5,ground:"hills",groundYScale:20,groundTexture:"walkernoise",groundColor:"#97684f",groundColor2:"#97684f",dressing1:"pyramids",dressing1Amount:20,dressing1Color:"#7c5c45",dressing1Scale:5,dressing1Variance:{x:20,y:20,z:20},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},checkerboard:{dressing2:"islands",dressing2Amount:100,dressing2Color:"#e40548",dressing2Scale:.14,dressing2Variance:{x:0,y:1,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:.7,active:!0,seed:1,skyType:"gradient",skyColor:"#404040",horizonColor:"#e40548",lighting:"distant",lightPosition:{x:0,y:1,z:-.2},fog:.71,flatShading:!0,playArea:1.5,ground:"spikes",groundYScale:30,groundTexture:"checkerboard",groundColor:"#252525",groundColor2:"#111111",dressing1:"islands",dressing1Amount:20,dressing1Color:"#6b4ff0",dressing1Scale:2.51,dressing1Variance:{x:10,y:15,z:10},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"dots",gridColor:"#6b4ff0",shadow:!1},forest:{dressing2:"grass",dressing2Amount:1500,dressing2Color:"#888b1d",dressing2Scale:.3,dressing2Variance:{x:1,y:2,z:0},dressing2UniformScale:!1,dressing2OnPlayArea:.8,active:!0,seed:8,skyType:"gradient",skyColor:"#24b59f",horizonColor:"#eff9b7",lighting:"distant",lightPosition:{x:-1.2,y:.88,z:-.55},fog:.8,flatShading:!1,playArea:1.5,ground:"noise",groundYScale:4.18,groundTexture:"squares",groundColor:"#937a24",groundColor2:"#987d2e",dressing1:"trees",dressing1Amount:500,dressing1Color:"#888b1d",dressing1Scale:1,dressing1Variance:{x:10,y:10,z:10},dressing1UniformScale:!0,dressing1OnPlayArea:.01,grid:"none",gridColor:"#c5a543",shadow:!0},goaland:{dressing2:"grass",dressing2Amount:1500,dressing2Color:"#db4453",dressing2Scale:1,dressing2Variance:{x:1,y:2,z:0},dressing2UniformScale:!1,dressing2OnPlayArea:.8,active:!0,seed:17,skyType:"gradient",skyColor:"#14645f",horizonColor:"#7ccb9a",lighting:"point",lightPosition:{x:.1,y:4,z:.56},fog:.73,flatShading:!1,playArea:1.5,ground:"canyon",groundYScale:100,groundTexture:"none",groundColor:"#ae3241",groundColor2:"#db4453",dressing1:"mushrooms",dressing1Amount:150,dressing1Color:"#a9313d",dressing1Scale:5,dressing1Variance:{x:5,y:10,z:5},dressing1UniformScale:!0,dressing1OnPlayArea:.01,grid:"none",gridColor:"#239893",shadow:!1},yavapai:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:11,skyType:"gradient",skyColor:"#239849",horizonColor:"#cfe0af",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1.5,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#C66344",groundColor2:"#c96b4b",dressing1:"stones",dressing1Amount:500,dressing1Color:"#C66344",dressing1Scale:.06,dressing1Variance:{x:.2,y:.1,z:.2},dressing1UniformScale:!0,dressing1OnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},goldmine:{dressing2:"stones",dressing2Amount:300,dressing2Color:"#fe921b",dressing2Scale:.2,dressing2Variance:{x:.2,y:.2,z:.2},dressing2UniformScale:!1,dressing2OnPlayArea:.83,active:!0,seed:53,skyType:"gradient",skyColor:"#1e1c1a",horizonColor:"#8c7964",lighting:"point",lightPosition:{x:0,y:1.5,z:3.33},fog:.25,flatShading:!0,playArea:1.5,ground:"canyon",groundYScale:100,groundTexture:"none",groundColor:"#353535",groundColor2:"#252525",dressing1:"hexagons",dressing1Amount:200,dressing1Color:"#fe921b",dressing1Scale:.5,dressing1Variance:{x:4,y:14,z:4},dressing1UniformScale:!0,dressing1OnPlayArea:.03,grid:"none",gridColor:"#222",shadow:!1},threetowers:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:5,skyType:"gradient",skyColor:"#23a06b",horizonColor:"#f5e170",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1.5,ground:"spikes",groundYScale:4.26,groundTexture:"walkernoise",groundColor:"#273a49",groundColor2:"#2b464f",dressing1:"towers",dressing1Amount:15,dressing1Color:"#5f6d94",dressing1Scale:50,dressing1Variance:{x:10,y:100,z:10},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"none",gridColor:"#239893",shadow:!1,dressing2:"cubes",dressing2Amount:30},poison:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:92,skyType:"gradient",skyColor:"#1ea84a",horizonColor:"#177132",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1.5,ground:"canyon",groundYScale:9.76,groundTexture:"none",groundColor:"#851f31",groundColor2:"#912235",dressing1:"hexagons",dressing1Amount:40,dressing1Color:"#c7415b",dressing1Scale:20,dressing1Variance:{x:20,y:200,z:20},dressing1UniformScale:!1,dressing1OnPlayArea:0,grid:"crosses",gridColor:"#1ea84a",shadow:!1},arches:{dressing2:"islands",dressing2Amount:50,dressing2Color:"#e446fb",dressing2Scale:1,dressing2Variance:{x:1,y:2,z:0},dressing2UniformScale:!1,dressing2OnPlayArea:.6,active:!0,seed:19,skyType:"atmosphere",skyColor:"#8cbdc8",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:.16,z:.33},fog:.67,flatShading:!0,playArea:1.5,ground:"canyon",groundYScale:10,groundTexture:"walkernoise",groundColor:"#5c4566",groundColor2:"#443a4e",dressing1:"arches",dressing1Amount:30,dressing1Color:"#62536f",dressing1Scale:26,dressing1Variance:{x:20,y:40,z:20},dressing1UniformScale:!0,dressing1OnPlayArea:.04,grid:"none",gridColor:"#ccc",shadow:!1},tron:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:14,skyType:"gradient",skyColor:"#091b39",horizonColor:"#284a9e",lighting:"distant",lightPosition:{x:-.72,y:.62,z:.4},fog:.8,flatShading:!1,playArea:1.5,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#061123",groundColor2:"#694439",dressing1:"towers",dressing1Amount:20,dressing1Color:"#fb000e",dressing1Scale:15,dressing1Variance:{x:20,y:20,z:20},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"1x1",gridColor:"#fb000e",shadow:!1},japan:{dressing2:"grass",dressing2Amount:1500,dressing2Color:"#db4453",dressing2Scale:.5,dressing2Variance:{x:1,y:2,z:0},dressing2UniformScale:!1,dressing2OnPlayArea:.6,active:!0,seed:14,skyType:"gradient",skyColor:"#7e5db5",horizonColor:"#b4adda",lighting:"distant",lightPosition:{x:1.33,y:1,z:.24},fog:.9,flatShading:!1,playArea:1.5,ground:"hills",groundYScale:25,groundTexture:"walkernoise",groundColor:"#7e5db5",groundColor2:"#cabdf5",dressing1:"torii",dressing1Amount:20,dressing1Color:"#db4453",dressing1Scale:15,dressing1Variance:{x:0,y:0,z:0},dressing1UniformScale:!0,dressing1OnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},dream:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:17,skyType:"gradient",skyColor:"#87faf4",horizonColor:"#b34093",lighting:"distant",lightPosition:{x:-.72,y:.53,z:.97},fog:.8,flatShading:!1,playArea:1.5,ground:"hills",groundYScale:20,groundTexture:"checkerboard",groundColor:"#b34093",groundColor2:"#c050a2",dressing1:"mushrooms",dressing1Amount:300,dressing1Color:"#3cf7ed",dressing1Scale:.2,dressing1Variance:{x:.2,y:.2,z:.2},dressing1UniformScale:!0,dressing1OnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},volcano:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:92,skyType:"gradient",skyColor:"#4a070f",horizonColor:"#f62300",lighting:"point",lightPosition:{x:.5,y:2.25,z:0},fog:.87,flatShading:!1,playArea:1.5,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#fb0803",groundColor2:"#510000",dressing1:"arches",dressing1Amount:15,dressing1Color:"#fb0803",dressing1Scale:3,dressing1Variance:{x:10,y:100,z:10},dressing1UniformScale:!1,dressing1OnPlayArea:.2,grid:"none",gridColor:"#fa0e00",shadow:!1},starry:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:-.01,z:-.46},fog:.7,flatShading:!1,playArea:1.5,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#553e35",groundColor2:"#694439",dressing1:"none",dressing1Amount:100,dressing1Color:"#795449",dressing1Scale:5,dressing1Variance:{x:1,y:1,z:1},dressing1UniformScale:!0,grid:"1x1",dressing1OnPlayArea:0,gridColor:"#39d2f2",shadow:!1},osiris:{dressing2:"none",dressing2Amount:10,dressing2Color:"#795449",dressing2Scale:1,dressing2Variance:{x:0,y:0,z:0},dressing2UniformScale:!0,dressing2OnPlayArea:0,active:!0,seed:46,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:.02,z:-.46},fog:0,flatShading:!1,playArea:1.5,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#9e7b47",groundColor2:"#9e7b47",dressing1:"pyramids",dressing1Amount:15,dressing1Color:"#9e7b47",dressing1Scale:5,dressing1Variance:{x:30,y:30,z:30},dressing1UniformScale:!0,grid:"dots",dressing1OnPlayArea:0,gridColor:"#daa452",shadow:!1}},init:function(){for(var e in this.STAGE_SIZE=200,this.random=this.random.bind(this),this.assets={arches:[{type:"mesh",vertices:[409,268,4,351,228,36,336,236,-57,-152,391,69,-135,358,88,-119,330,43,-20,358,-35,-153,357,-47,37,413,-26,-20,411,-14,-302,148,154,-339,121,-126,-389,200,-88,-477,193,-76,-314,346,-19,-314,306,-30,-250,296,-73,-267,237,-82,-212,303,-68,-245,200,-67,-223,304,108,-329,299,107,-289,350,76,-320,342,69,119,373,-39,38,370,8,113,367,52,492,202,-31,462,83,-104,447,71,-80,426,112,25,482,189,-7,222,372,6,121,402,41,87,382,67,221,346,55,559,93,-13,528,47,39,505,21,-111,528,54,-101,616,31,-53,442,256,-15,300,338,19,257,308,-79,408,256,-74,312,352,-26,384,297,-31,437,257,-47,-29,415,53,-232,377,59,-139,335,77,-132,344,2,-18,377,-37,-171,387,-28,-254,384,18,-651,-27,27,-435,-28,179,-345,149,165,-272,-28,23,-215,146,-2,-279,-29,-59,-211,145,-55,-337,-28,-128,-413,247,0,-293,363,24,-214,254,-36,-164,290,33,-284,150,94,-218,362,105,75,369,29,518,147,-63,447,190,-70,445,56,-105,391,185,-60,431,49,-33,459,83,26,470,162,42,130,390,53,167,341,-30,125,394,-45,239,368,-17,91,414,10,450,18,2,449,-27,-9,436,-28,-58,496,-27,-110,582,-28,-140,647,-27,-56,325,325,-45,-307,297,-56,-647,-28,-45,-188,310,-54,-264,197,113,-367,175,139,8,387,82,426,45,-55,114,359,-28,500,27,44,461,-29,13,-512,-27,-151,-152,376,-38,-490,-28,148,12,370,-28,442,160,42,465,194,32,381,183,-33,649,-27,-34,444,16,29,616,-28,25,417,267,-66,-132,352,-34,-322,-27,130,-271,86,-115,-635,-28,-121,-291,203,-99,176,405,-10,561,52,-93,371,305,9,311,237,-22,377,200,-81,-129,406,46,-154,371,99,-82,361,71,-21,354,26,-91,363,-27,-165,413,-12,-414,215,110,-238,127,26,-408,-28,-128,-674,-28,-94,-446,232,-39,-311,226,-90,-255,210,-61,-235,192,-11,-217,218,58,-269,299,124,-386,276,78,-399,281,42,15,373,58,16,393,75,549,107,-46,481,188,-68,409,120,-41,541,81,12,230,368,41,194,350,-50,224,361,-50,604,-28,-10,602,-27,35,486,56,-121,502,69,-120,457,-27,-110,226,317,-40,-584,-28,-124,439,-26,-30,467,-26,39,547,-27,-146,21,368,14,466,229,-29,578,-27,44,609,-27,-96,291,356,-15,290,306,34,255,321,28,231,311,-5,-251,386,50,-183,307,87,-152,307,24,-264,373,-12,-392,-27,190,-333,-28,84,-281,-27,54,-270,-28,-23,-308,-28,-101,-687,-27,-59,39,418,39,413,163,25,404,206,-90,54,400,-31,121,352,8,-454,41,148,-426,9,182,-564,115,3,-427,27,-107,-548,118,-32,-556,122,-53,-517,91,-101,-475,54,140,-461,52,-134,-558,119,-71,-434,286,59,-687,-31,52,-595,146,22,-670,-28,164,-537,166,122,-575,-28,217,-566,159,65,-470,152,136,-712,-29,102,-639,-29,211,-532,-30,181,-442,-30,-100],faces:[76,104,162,1,176,103,103,76,1,2,119,73,73,105,2,2,118,152,45,161,46,46,109,45,3,120,49,49,68,3,3,121,139,139,48,3,4,122,94,94,121,4,6,123,124,9,175,81,10,169,111,10,67,92,88,43,146,11,131,114,11,128,183,13,130,15,90,184,174,90,182,184,130,184,63,14,130,63,15,130,14,16,131,12,15,168,53,18,91,17,131,16,17,65,133,132,65,132,91,67,134,166,166,92,67,20,135,92,20,166,4,4,121,20,22,135,68,25,102,96,25,157,102,69,138,157,69,157,25,39,150,71,71,141,39,28,150,149,149,72,28,142,176,105,36,140,27,27,143,36,32,115,81,32,144,161,161,80,32,77,35,144,34,26,77,78,179,96,145,152,78,178,79,145,80,146,79,147,140,36,143,108,36,143,37,148,74,95,154,154,83,74,72,149,151,151,95,72,38,150,156,40,147,106,70,140,40,40,116,70,42,162,0,35,163,162,43,145,146,46,117,41,47,158,27,48,139,175,122,138,94,157,138,123,52,178,102,52,102,6,52,124,7,7,100,52,53,125,8,57,93,181,56,169,181,59,127,58,60,173,61,62,128,11,11,112,62,65,91,167,65,167,66,126,93,21,22,68,49,72,95,29,142,29,74,74,82,142,75,107,97,75,97,103,76,97,37,104,143,31,78,152,164,78,164,179,79,178,8,97,155,159,107,98,155,83,98,82,154,95,84,39,116,86,86,156,39,87,160,116,24,145,96,162,104,0,105,118,2,43,177,119,44,177,43,91,51,167,44,88,109,46,161,117,3,68,121,3,48,120,4,166,50,50,122,4,5,123,122,123,138,122,110,124,51,170,10,111,110,91,7,7,124,110,8,125,9,9,81,8,186,12,188,92,135,10,11,114,112,64,63,137,13,15,89,89,53,100,64,168,14,14,168,15,89,100,16,16,12,89,100,18,16,17,91,132,112,19,61,18,7,91,19,17,132,133,127,59,133,59,61,136,21,22,134,127,133,20,92,166,121,135,20,158,31,27,21,135,22,23,137,136,24,102,178,178,145,24,25,179,69,26,94,138,27,140,70,27,70,141,150,177,71,28,177,150,29,142,73,73,119,29,142,82,30,30,176,142,107,75,82,31,143,27,33,81,175,31,41,104,115,79,8,32,33,144,80,115,32,33,175,139,35,162,42,77,139,34,163,26,179,163,179,164,78,96,145,177,29,119,108,143,148,148,37,159,97,159,37,74,83,82,38,149,150,156,150,39,40,106,87,87,116,40,140,147,40,161,144,42,42,117,161,41,0,104,41,117,0,0,117,42,164,118,163,1,163,118,118,176,1,118,105,176,152,118,164,43,152,145,43,119,2,71,109,141,47,41,158,44,71,177,45,109,88,45,88,146,46,47,109,141,47,27,167,50,166,49,120,165,139,121,94,5,122,50,123,51,124,157,6,102,157,123,6,100,8,178,5,167,51,6,124,52,100,178,52,53,168,125,125,165,120,54,125,168,9,48,175,120,9,125,93,10,135,181,101,56,57,169,10,59,172,61,67,170,171,67,171,127,58,127,171,129,186,113,60,61,172,61,173,112,62,112,173,174,189,129,165,64,23,64,137,23,165,22,49,64,54,168,17,114,131,17,112,114,66,133,65,19,132,133,19,133,61,134,133,66,166,134,66,166,66,167,93,135,21,68,135,121,23,136,22,94,34,139,25,96,179,26,138,69,69,179,26,30,103,176,116,141,70,39,141,116,73,142,105,143,76,37,26,35,77,103,97,76,77,144,33,33,139,77,38,151,149,80,161,45,80,45,146,81,115,8,107,155,97,82,98,107,95,151,84,38,156,85,86,116,160,96,102,24,72,29,28,29,95,74,75,30,82,108,147,36,88,44,43,91,110,51,170,67,10,11,183,131,64,14,63,89,15,53,100,7,18,112,17,19,127,134,67,136,126,21,158,41,31,33,32,81,115,80,79,177,28,29,43,2,152,71,44,109,47,46,41,141,109,47,167,5,50,123,5,51,100,53,8,125,54,165,9,120,48,93,57,10,59,58,172,174,185,189,165,54,64,165,23,22,94,26,34,30,75,103,143,104,76,26,163,35,38,85,151,192,182,191,183,128,201,12,13,89,181,169,57,186,153,113,188,183,99,184,182,63,185,13,189,180,181,93,186,99,153,189,186,129,185,184,130,186,13,12,187,93,126,193,199,194,194,196,193,200,187,195,187,197,195,187,126,197,197,190,194,190,136,137,190,196,194,63,182,192,63,192,196,192,198,196,191,182,55,193,196,198,194,199,197,195,197,199,136,197,126,190,137,63,190,63,196,197,136,190,192,191,198,201,99,183,90,55,182,181,180,101,185,130,13,186,188,99,186,189,13,187,180,93,200,101,187,183,188,131,184,185,174,180,187,101,16,18,17,12,131,188,35,42,144,163,1,162,76,162,1,79,146,145]}],stones:[{type:"mesh",vertices:[-376,189,42,230,223,-310,353,162,-62,414,-23,-67,256,90,-475,24,85,-526,-418,-16,57,-432,66,-40,-199,151,-376,-155,49,467,-91,289,201,293,197,91,81,-17,-480,42,108,431,-359,-17,-250,383,-19,-243,194,-15,270,-272,180,293,-86,212,262,234,54,297,395,97,-302,-123,-21,-444,-416,-19,-123,-323,-18,267,-100,-16,429,-300,96,-361,163,-19,409,118,201,-431,-241,-18,391,-130,274,-309,306,-19,-399,-221,96,404],faces:[31,18,17,0,17,18,3,20,2,18,11,10,29,27,8,27,29,1,0,18,10,10,29,0,16,19,26,11,2,1,20,30,4,20,3,15,30,12,4,4,12,5,5,27,4,4,27,20,21,25,5,7,8,25,22,7,14,7,25,14,23,28,31,0,7,17,24,26,9,31,28,9,8,27,5,2,20,1,13,19,18,10,11,1,19,13,26,3,11,19,19,16,3,11,3,2,11,18,19,20,15,30,29,10,1,25,21,14,8,5,25,5,12,21,6,7,22,7,6,23,8,0,29,8,7,0,23,31,7,13,31,9,18,31,13,9,28,24,26,13,9,27,1,20,7,31,17]},{type:"mesh",vertices:[-217,34,-153,198,90,20,212,85,169,-131,93,171,197,113,30,173,121,164,315,29,-16,219,24,189,282,50,-102,232,38,-181,-195,-9,-166,-156,30,-207,-51,-9,-231,-180,91,-173,-19,73,-204,-280,23,96,-242,100,107,3,158,-82,109,88,221,275,-10,-40,236,-10,-135,-178,49,184,-1,-10,-243,265,-11,109,-12,-9,237,-36,46,251,-233,86,-81,93,77,-171,-163,133,69,18,16,263,296,44,93,131,-12,-226,-89,-10,-201,-273,-10,-51,-240,-9,110,190,-12,192,-253,-11,-92,42,43,-258,-115,-11,238,168,99,-88,-285,-10,24,71,124,-158,298,-10,10,116,150,-24,-282,44,39],faces:[44,16,26,13,26,16,0,26,13,27,14,41,4,5,1,7,30,2,28,5,43,41,39,27,17,43,41,43,4,39,13,28,17,17,41,13,28,43,17,24,29,38,29,35,7,18,25,29,5,18,2,18,5,3,30,42,6,30,35,23,19,20,8,8,20,9,9,39,8,1,30,8,31,37,9,11,14,37,14,27,37,32,11,12,11,37,12,11,0,13,33,40,44,44,26,33,33,0,36,34,38,15,44,40,15,21,3,16,27,39,9,2,30,1,21,25,3,16,3,28,28,3,5,4,43,5,41,43,39,13,16,28,25,21,38,38,29,25,7,18,29,29,24,35,18,7,2,18,3,25,30,23,42,30,7,35,8,30,6,6,19,8,6,42,19,8,39,1,37,31,22,27,9,37,9,20,31,10,11,32,11,10,0,12,37,22,14,13,41,14,11,13,33,26,0,36,0,10,21,44,15,16,44,21,15,40,34,38,21,15,4,1,39,5,2,1]},{type:"mesh",vertices:[-101,102,57,99,35,102,40,72,80,59,14,-168,-186,22,45,-176,25,-30,66,-7,146,153,-7,53,-110,47,-96,-90,-8,-146,150,-7,-12,-200,-7,8,-173,-7,-55,55,46,-60,125,-7,110,136,30,-10,-149,58,68,-15,82,-71,98,-7,-86,-34,-6,-194,-33,-7,171,-36,65,137,38,-8,-192,-103,-9,147,-12,62,-152],faces:[2,17,0,17,8,0,17,24,8,19,24,22,5,11,4,2,13,17,17,13,24,21,23,20,1,2,21,7,15,1,7,10,15,5,9,12,15,18,13,0,5,16,0,8,5,1,15,2,10,18,15,3,13,18,24,3,22,11,23,4,4,16,5,16,4,23,24,13,3,15,13,2,6,1,21,6,21,20,6,14,1,2,0,21,1,14,7,3,18,22,8,24,19,8,19,9,12,11,5,5,8,9,16,23,21,16,21,0]},{type:"mesh",vertices:[86,55,-18,58,38,73,97,-12,79,135,7,10,-93,-11,-72,-133,5,33,13,68,-32,94,-11,-57,-90,52,53,-24,-11,-106,-13,-10,104,-75,49,-69,-12,18,114,49,-12,-96,-46,-11,-85,-119,-11,-26,48,5,-111,-58,-11,105,-117,-12,52,-5,35,-93,123,-11,7],faces:[5,8,11,2,3,1,8,1,6,11,8,6,6,19,11,10,12,17,20,7,3,3,7,16,16,0,3,16,9,19,14,4,9,15,18,5,5,11,15,18,17,5,19,0,16,1,3,0,0,6,1,19,6,0,12,8,17,2,1,12,12,10,2,1,8,12,3,2,20,16,13,9,16,7,13,19,4,11,15,11,4,17,8,5,9,4,19]}],torii:[{type:"mesh",mirror:!0,flatShading:!0,vertices:[692,966,-52,661,834,-52,692,966,52,661,834,52,0,894,-52,0,776,-52,0,894,52,0,776,52,518,935,52,345,913,52,170,899,52,162,779,52,328,790,52,494,808,52,170,899,-52,345,913,-52,518,935,-52,494,808,-52,328,790,-52,162,779,-52,0,618,16,0,697,16,0,618,-16,0,697,-16,586,618,16,586,697,16,586,618,-16,586,697,-16,331,-29,-75,331,766,-52,369,-29,-65,357,766,-45,396,-29,-37,377,766,-26,406,-29,0,384,766,0,396,-29,37,377,766,26,369,-29,65,357,766,45,331,-29,75,331,766,52,294,-29,65,305,766,45,267,-29,37,286,766,26,257,-29,0,279,766,0,267,-29,-37,286,766,-26,294,-29,-65,305,766,-45,0,777,85,0,681,33,333,762,-75,333,806,-75,371,762,-65,371,806,-65,398,762,-37,398,806,-37,408,762,0,408,806,0,398,762,37,398,806,37,371,762,65,371,806,65,333,762,75,333,806,75,296,762,65,296,806,65,268,762,37,268,806,37,258,762,0,258,806,0,268,762,-37,268,806,-37,296,762,-65,296,806,-65,0,681,-33,0,777,-85,52,681,33,52,777,85,52,681,-33,52,777,-85],faces:[4,10,14,1,13,17,11,6,7,0,3,1,16,1,17,4,19,5,14,18,19,15,17,18,3,8,13,13,9,12,12,10,11,19,7,5,19,12,11,18,13,12,16,2,0,15,8,16,14,9,15,23,26,22,27,24,26,25,20,24,26,20,22,23,25,27,29,30,28,31,32,30,33,34,32,35,36,34,37,38,36,39,40,38,41,42,40,43,44,42,45,46,44,47,48,46,49,50,48,51,28,50,55,56,54,57,58,56,59,60,58,61,62,60,63,64,62,79,81,83,65,66,64,82,53,78,67,68,66,81,53,80,69,70,68,83,80,82,71,72,70,79,82,78,73,74,72,75,63,59,75,76,74,77,54,76,60,68,76,4,6,10,1,3,13,11,10,6,0,2,3,16,0,1,4,14,19,14,15,18,15,16,17,3,2,8,13,8,9,12,9,10,19,11,7,19,18,12,18,17,13,16,8,2,15,9,8,14,10,9,23,27,26,27,25,24,25,21,20,26,24,20,23,21,25,29,31,30,31,33,32,33,35,34,35,37,36,37,39,38,39,41,40,41,43,42,43,45,44,45,47,46,47,49,48,49,51,50,51,29,28,55,57,56,57,59,58,59,61,60,61,63,62,63,65,64,79,52,81,65,67,66,82,80,53,67,69,68,81,52,53,69,71,70,83,81,80,71,73,72,79,83,82,73,75,74,59,57,55,55,77,75,75,73,71,71,69,75,67,65,63,63,61,59,59,55,75,75,69,67,67,63,75,75,77,76,77,55,54,76,54,56,56,58,76,60,62,68,64,66,68,68,70,72,72,74,68,76,58,60,62,64,68,68,74,76]}],islands:[{type:"mesh",flatShading:!0,vertices:[0,3814,0,-358,4995,910,-991,4998,-4,-233,5033,-865,200,5270,1092,-610,5199,-726,115,7344,272,650,4860,400,1021,5613,-198,644,5628,735,-926,5949,-65,707,5187,-783,-478,5991,830,-438,6319,-585,220,6075,-797],faces:[0,7,1,0,1,2,0,2,3,0,3,11,2,1,10,1,4,12,4,9,6,5,10,13,8,14,6,14,13,6,13,12,6,13,10,12,12,4,6,6,9,8,8,11,14,3,13,14,3,5,13,11,3,14,5,2,10,10,1,12,4,7,9,9,7,8,7,11,8,3,2,5,7,0,11,1,7,4]}],grass:[{type:"mesh",vertices:[-63,-21,68,65,-37,19,58,237,31,231,391,10,136,228,61,6,-5,9,24,-14,-4,0,350,-25,-52,-10,-29,-83,-18,1,-5,333,115,-46,-15,76,102,-4,96,83,236,60,74,0,27,60,139,54],faces:[2,4,3,1,4,5,2,5,4,6,8,7,9,11,10,12,14,15,15,13,12,2,0,5]},{type:"mesh",vertices:[919,-21,-61,821,-18,-96,885,128,-87,795,264,-142,836,119,-154,865,-5,-152,630,-4,140,647,236,177,654,0,211,669,139,184],faces:[2,4,3,1,4,5,2,5,4,6,8,9,9,7,6,2,0,5]},{type:"mesh",vertices:[274,-12,-520,305,520,-536,274,-12,-535,289,-12,-528,274,254,-520,278,254,-535,289,254,-524,215,474,-552,268,495,-540,276,483,-554,314,452,-588,329,442,-570,271,490,-514,337,429,-630,303,493,-535,293,454,-584,300,461,-534,289,444,-503,277,436,-504,274,435,-469,311,448,-497,299,446,-533,343,441,-534,320,444,-516,300,457,-534,328,467,-558,332,470,-540,301,476,-535,305,516,-536,303,537,-533,308,540,-555],faces:[4,1,5,5,3,2,3,1,6,6,1,4,6,0,3,4,2,0,7,8,9,9,8,14,7,12,8,13,10,11,14,8,12,11,10,16,13,15,10,16,10,15,19,17,18,18,17,21,19,20,17,21,17,20,23,22,24,26,25,27,29,28,30,5,1,3,6,4,0,4,5,2]}],hexagons:[{type:"extrude",vertices:[-.198,-.302,.197,-.3,.372,0,.199,.298,-.202,.298,-.368,0]}],towers:[{type:"extrude",vertices:[-.054,-.178,-.007,-.182,.069,-.027,.189,.079,.178,.124,-.007,.097,-.145,.182,-.178,.144,-.079,-.021]},{type:"lathe",segments:4,vertices:[.004,.02,.012,.092,.042,.166,.067,.55,.101,.594,.105,.838,.193,.934,.18,.994]},{type:"lathe",segments:5,vertices:[.069,.216,.067,.562,.126,.562,.128,.774,.191,.774,.193,.986]}],trees:[{type:"lathe",noise:.015,segments:6,vertices:[1e-6,.826,.054,.832,.105,.854,.136,.9,.136,.958,.118,.994]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.01,.069,.022,.13,.068,.178,.18,.189,.32,.191,.59,.193,.75,.138,.79,.018,.808,.018,.996]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.436,.126,.46,.201,.57,.219,.72,.154,.846,.028,.884,.034,.996]}],apparatus:[{type:"lathe",segments:10,vertices:[1e-6,.23,.042,.23,.069,.36,.038,.362,.038,.372,.06,.372,.073,.572,.024,.572,.024,.67,.069,.67,.075,.722,.097,.724,.105,.852,.083,.902,.065,.902,.065,.924,.128,.924,.146,.996]},{type:"lathe",segments:16,vertices:[1e-6,.232,.229,.182,.486,.07,.356,.182,.213,.242,.154,.242,.144,.262,.178,.262,.126,.314,.04,.328,.038,.374,.058,.374,.071,.408,.026,.406,.03,.42,.091,.418,.034,.496,.01,.498,.03,.506,.014,.998]}],mushrooms:[{type:"lathe",noise:.02,segments:14,vertices:[1e-6,.006,.13,.018,.341,.084,.437,.144,.492,.234,.484,.246,.276,.232,.107,.284,.046,.346,.062,.852,.097,.956,.166,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.562,.091,.572,.172,.61,.223,.666,.256,.74,.258,.806,.246,.824,.062,.826,.065,.948,.097,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.768,.099,.772,.219,.802,.306,.844,.352,.886,.352,.908,.118,.904,.107,.93,.115,.966,.14,.996]}]},this.assets)for(var t=0;t<this.assets[e].length;t++){var r=this.assets[e][t];if("mesh"==r.type)for(var i=0,o=r.vertices.length;i<o;i++)r.vertices[i]/=1e3}this.userFog=this.el.sceneEl.getAttribute("fog"),this.sky=document.createElement("a-sky"),this.sky.setAttribute("radius",this.STAGE_SIZE),this.sky.setAttribute("theta-length",110),this.sky.classList.add("environment"),this.stars=null,this.groundMaterial=null,this.ground=document.createElement("a-entity"),this.ground.setAttribute("rotation","-90 0 0"),this.ground.classList.add("environmentGround"),this.ground.classList.add("environment"),this.groundCanvas=null,this.groundTexture=null,this.groundMaterial=null,this.groundGeometry=null,this.dressing1=document.createElement("a-entity"),this.dressing1.classList.add("environmentDressing"),this.dressing1.classList.add("environment"),this.dressing2=document.createElement("a-entity"),this.dressing2.classList.add("environmentDressing"),this.dressing2.classList.add("environment"),this.gridCanvas=null,this.gridTexture=null,this.hemilight=document.createElement("a-entity"),this.hemilight.classList.add("environment"),this.hemilight.setAttribute("position","0 50 0"),this.hemilight.setAttribute("light",{type:"hemisphere",color:"#CEE4F0",intensity:.4}),this.sunlight=document.createElement("a-entity"),this.sunlight.classList.add("environment"),this.sunlight.setAttribute("position",this.data.lightPosition),this.sunlight.setAttribute("light",{intensity:.6,shadowCameraNear:.01}),this.el.appendChild(this.hemilight),this.el.appendChild(this.sunlight),this.el.appendChild(this.ground),this.el.appendChild(this.dressing1),this.el.appendChild(this.dressing2),this.el.appendChild(this.sky)},getFogColor:function(e,t){var r;if("color"==e||"none"==e)r=new THREE.Color(this.data.skyColor),this.random;else if("gradient"==e)r=new THREE.Color(this.data.horizonColor),this.random;else if("atmosphere"==e){var i=[1,.5,.22,.1,.05,0],o=["#C0CDCF","#81ADC5","#525e62","#2a2d2d","#141616","#000"];if(t<=0)return"#000";t=Math.min(1,t);for(var s=0;s<i.length;s++)if(t>i[s]){var a=n(new THREE.Color(o[s-1]),this.random,this.data.varyColor),l=n(new THREE.Color(o[s]),this.random,this.data.varyColor),d=(t-i[s])/(i[s-1]-i[s]);l.lerp(a,d),r=l;break}}return r.multiplyScalar(.9),r.lerp(new THREE.Color(this.data.groundColor),.3),"#"+r.getHexString()},update:function(e){if(!e||void 0===e.preset||e.preset!==this.data.preset){var t=Object.assign({},this.presets[this.data.preset]);if(e&&void 0!==e.preset||Object.assign(t,this.el.components.environment.attrValue),this.el.setAttribute("environment",t),e)return;e={}}this.seed=(this.data.seed+"").split("").map((e,t)=>""+(t+2)+e).reduce((e,t)=>e+parseInt(t)*t.charCodeAt(1),0);var r=this.data.skyType,i=new THREE.Vector3(this.data.lightPosition.x,this.data.lightPosition.y,this.data.lightPosition.z);if(i.normalize(),this.sunlight){if(this.sunlight.setAttribute("position",this.data.lightPosition),"atmosphere"!=r){var o=new THREE.Color(this.data.skyColor);o.r=(o.r+1)/2,o.g=(o.g+1)/2,o.b=(o.b+1)/2,this.hemilight.setAttribute("light",{color:"#"+o.getHexString()}),this.sunlight.setAttribute("light",{intensity:.6}),this.hemilight.setAttribute("light",{intensity:.6})}else this.sunlight.setAttribute("light",{intensity:.1+.5*i.y}),this.hemilight.setAttribute("light",{intensity:.1+.5*i.y});this.sunlight.setAttribute("light",{castShadow:this.data.shadow,shadowCameraLeft:-this.data.shadowSize,shadowCameraBottom:-this.data.shadowSize,shadowCameraRight:this.data.shadowSize,shadowCameraTop:this.data.shadowSize})}if(r!=e.skyType||this.data.skyColor!=e.skyColor||this.data.horizonColor!=e.horizonColor){this.sky.removeAttribute("material");var n={};n.shader={none:"flat",color:"flat",gradient:"gradientshader",atmosphere:"skyshader"}[r],this.stars&&this.stars.setAttribute("visible","atmosphere"==r),"color"==r?(n.color=this.data.skyColor,n.fog=!1):"gradient"==r&&(n.topColor=this.data.skyColor,n.bottomColor=this.data.horizonColor),this.sky.setAttribute("material",n)}"atmosphere"==r&&(this.sky.setAttribute("material",{sunPosition:i}),this.setStars(2e3*(1-Math.max(0,8*(i.y+.08))))),this.data.fog>0?this.el.sceneEl.setAttribute("fog",{color:this.getFogColor(r,i.y),far:(1.01-this.data.fog)*this.STAGE_SIZE*2}):this.el.sceneEl.removeAttribute("fog"),this.sunlight.setAttribute("light",{type:"point"==this.data.lighting?"point":"directional"}),this.sunlight.setAttribute("visible","none"!==this.data.lighting),this.hemilight.setAttribute("visible","none"!==this.data.lighting);var s=!this.groundGeometry||this.data.seed!=e.seed||this.data.ground!=e.ground||this.data.playArea!=e.playArea||this.data.flatShading!=e.flatShading;(s||this.data.groundColor!=e.groundColor||this.data.groundColor2!=e.groundColor2||this.data.groundYScale!=e.groundYScale||this.data.groundTexture!=e.groundTexture||this.data.gridColor!=e.gridColor||this.data.grid!=e.grid)&&(this.updateGround(s),this.hemilight&&this.hemilight.setAttribute("light",{groundColor:this.data.groundColor})),this.updateDressing(1),this.updateDressing(2),this.sky.setAttribute("visible","none"!==r),this.el.setAttribute("visible",this.data.active),this.data.active||(this.userFog?this.el.sceneEl.setAttribute("fog",this.userFog):this.el.sceneEl.removeAttribute("fog")),this.dumpParametersDiff()},logPreset:function(){var e="{";for(var t in this.schema)if("preset"!=t){e+=t+": ";var r=this.schema[t].type;e+="vec3"==r?"{ x: "+this.data[t].x+", y: "+this.data[t].y+", z: "+this.data[t].z+"}":"string"==r||"color"==r?'"'+this.data[t]+'"':this.data[t],e+=", "}e+="}",console.log(e)},dumpParametersDiff:function(){function e(e){return Math.floor(1e3*e)/1e3}var t=[],r="none"!=this.data.preset&&this.presets[this.data.preset];for(var i in r&&t.push("preset: "+this.data.preset),this.schema)if(!("preset"==i||r&&void 0===r[i])){var o=r?r[i]:this.schema[i].default,n=this.data[i];if("vec3"==this.schema[i].type){var s=o;"string"==typeof o&&(s={x:(o=o.split(" "))[0],y:o[1],z:o[2]}),e(s.x)==e(n.x)&&e(s.y)==e(n.y)&&e(s.z)==e(n.z)||t.push(i+": "+e(n.x)+" "+e(n.y)+" "+e(n.z))}else o!=n&&("number"==this.schema[i].type&&(n=e(n)),t.push(i+": "+n))}console.log("%c"+t.join("; "),"color: #f48;font-weight:bold")},random:function(e){var t;return 0===(t=parseFloat("0."+Math.sin(9999*this.seed*e).toString().substr(7)))&&(t=parseFloat("0."+Math.sin(99999*this.seed*e).toString().substr(7))),t},updateGround:function(e){if(e){var t="none"!=this.data.ground;if(this.ground.setAttribute("visible",t),!t)return;this.groundGeometry||(this.groundGeometry=new THREE.PlaneGeometry(this.STAGE_SIZE+2,this.STAGE_SIZE+2,63,63));for(var r=new o,i=this.groundGeometry.vertices,n=this.groundGeometry.vertices.length,s=0,a=0,l=0;s<n;s++)if("flat"!=this.data.ground){var d;switch(this.data.ground){case"hills":d=Math.max(0,r.noise(a,l,0));break;case"canyon":d=.2+.8*r.noise(a,l,0),d=Math.min(1,10*Math.pow(d,2));break;case"spikes":d=this.random(s)<.02?this.random(s+1):0;break;case"noise":d=this.random(s)<.35?this.random(s+1):0}d+=.1*this.random(s+2);var c=2*a/10-1,u=2*l/10-1,h=this.data.playArea;(d*=(c=Math.max(0,Math.min(1,(Math.abs(c)-(h-.9))*(1/h))))>(u=Math.max(0,Math.min(1,(Math.abs(u)-(h-.9))*(1/h))))?c:u)<.01&&(d=0),i[s].z=d,(a+=10/64)>=10&&(a=0,l+=10/64)}else i[s].z=0;this.groundGeometry.computeFaceNormals(),this.data.flatShading?this.groundGeometry.computeFlatVertexNormals():this.groundGeometry.computeVertexNormals(),this.groundGeometry.verticesNeedUpdate=!0,this.groundGeometry.normalsNeedUpdate=!0}this.ground.object3D.scale.z=Math.max(100*this.random(1e3),1);var p=this.STAGE_SIZE/20;this.groundCanvas&&2048==this.groundCanvas.width||(this.gridCanvas=document.createElement("canvas"),this.gridCanvas.width=2048,this.gridCanvas.height=2048,this.gridTexture=new THREE.Texture(this.gridCanvas),this.gridTexture.wrapS=THREE.RepeatWrapping,this.gridTexture.wrapT=THREE.RepeatWrapping,this.gridTexture.repeat.set(p,p),this.groundCanvas=document.createElement("canvas"),this.groundCanvas.width=2048,this.groundCanvas.height=2048,this.groundTexture=new THREE.Texture(this.groundCanvas),this.groundTexture.wrapS=THREE.RepeatWrapping,this.groundTexture.wrapT=THREE.RepeatWrapping,this.groundTexture.repeat.set(p,p),this.groundMaterialProps={map:this.groundTexture,emissive:new THREE.Color(16777215),emissiveMap:this.gridTexture},(new THREE.Material).hasOwnProperty("shading")?this.groundMaterialProps.shading=this.data.flatShading?THREE.FlatShading:THREE.SmoothShading:this.groundMaterialProps.flatShading=this.data.flatShading,this.groundMaterial=new THREE.MeshLambertMaterial(this.groundMaterialProps));var f=this.groundCanvas.getContext("2d"),g=this.gridCanvas.getContext("2d");if(this.drawTexture(f,2048,20),g.fillStyle="#000000",g.fillRect(0,0,2048,2048),this.drawGrid(g,2048,20),this.groundTexture.needsUpdate=!0,this.gridTexture.needsUpdate=!0,e){var m=new THREE.Mesh(this.groundGeometry,this.groundMaterial);this.ground.setObject3D("mesh",m)}else this.ground.getObject3D("mesh").material=this.groundMaterial;this.ground.setAttribute("shadow",{cast:!1,receive:!0})},drawGrid:function(e,t,r){if("none"!=this.data.grid){var i,o,n,s=Math.floor(r/2),a=t/(r/2);switch(e.fillStyle=this.data.gridColor,this.data.grid){case"1x1":case"2x2":for("1x1"==this.data.grid&&(s*=2,a=t/r),i=0;i<s;i++)n=Math.floor(i*a),e.fillRect(0,n,t,1),e.fillRect(n,0,1,t);break;case"crosses":var l=Math.floor(a/20);for(i=0;i<s+1;i++)for(n=Math.floor(i*a),o=0;o<s+1;o++){var d=Math.floor(o*a-l);e.fillRect(d,n,2*l,1),e.fillRect(n,d,1,2*l)}break;case"dots":for(i=0;i<s+1;i++)for(o=0;o<s+1;o++)e.beginPath(),e.arc(Math.floor(o*a),Math.floor(i*a),4,0,2*Math.PI),e.fill();break;case"xlines":for(i=0;i<s;i++)e.fillRect(Math.floor(i*a),0,1,t);break;case"ylines":for(i=0;i<s;i++)e.fillRect(0,Math.floor(i*a),t,1)}}},drawTexture:function(e,t,r){var i,s,a,l,d,c,u;if(e.fillStyle=this.data.groundColor,e.fillRect(0,0,t,t),"none"!=this.data.groundTexture)switch(this.data.groundTexture){case"checkerboard":e.fillStyle=this.data.groundColor2;var h=Math.floor(r/2),p=t/(r/2);for(i=0;i<h+1;i+=2)for(var f=0;f<h+1;f++)e.fillRect(Math.floor((i+f%2)*p),Math.floor(f*p),Math.floor(p),Math.floor(p));break;case"squares":var g=t/16;for(a=n(new THREE.Color(this.data.groundColor),this.random,this.data.varyColor),l=n(new THREE.Color(this.data.groundColor2),this.random,this.data.varyColor),i=0;i<256;i++)(s=this.random(i+3)>.5?a.clone():l.clone()).addScalar(.1*this.random(i+3)-.05),e.fillStyle="#"+s.getHexString(),e.fillRect(i%16*g,Math.floor(i/16)*g,g,g);break;case"noise":d=(c=e.getImageData(0,0,t,t)).data,a=n(new THREE.Color(this.data.groundColor),this.random,this.data.varyColor),l=n(new THREE.Color(this.data.groundColor2),this.random,this.data.varyColor);var m=new THREE.Color(l.r-a.r,l.g-a.g,l.b-a.b),y=new o;for(i=0,f=0,u=d.length;i<u;i+=4,f++){var v=y.noise(f%t/t*3,f/t/t*3,0);d[i+0]=Math.floor(255*(a.r+m.r*v)),d[i+1]=Math.floor(255*(a.g+m.g*v)),d[i+2]=Math.floor(255*(a.b+m.b*v))}e.putImageData(c,0,0);break;case"walkernoise":var E=Math.floor(t/2),A=document.createElement("canvas");A.width=E,A.height=E;var x=A.getContext("2d");x.fillStyle=this.data.groundColor,x.fillRect(0,0,E,E),d=(c=x.getImageData(0,0,E,E)).data,a=n(new THREE.Color(this.data.groundColor),this.random,this.data.varyColor),l=n(new THREE.Color(this.data.groundColor2),this.random,this.data.varyColor);var b=[];for(i=0;i<1e3;i++)s=a.clone().lerp(l,Math.random()),b.push({x:Math.random()*E,y:Math.random()*E,r:Math.floor(255*s.r),g:Math.floor(255*s.g),b:Math.floor(255*s.b)});for(var _=0;_<5e3;_++)for(i=0;i<1e3;i++){var C=b[i],T=4*Math.floor(C.y*E+C.x);d[T+0]=C.r,d[T+1]=C.g,d[T+2]=C.b,C.x+=Math.floor(3*Math.random())-1,C.y+=Math.floor(3*Math.random())-1,C.x>=E&&(C.x=C.x-E),C.y>=E&&(C.y=C.y-E),C.x<0&&(C.x=E+C.x),C.y<0&&(C.y=E+C.y)}x.putImageData(c,0,0),e.drawImage(A,0,0,t,t)}},getAssetGeometry:function(e){if(!e)return null;var t,r,i,o=[],n=this;function s(e,t){for(var r=new THREE.Vector3,i=0,o=e.vertices.length;i<o;i++)r.x=(n.random(i)-.5)*t,r.y=(n.random(i+o)-.5)*t,r.z=(n.random(i+2*o)-.5)*t,e.vertices[i].add(r)}for(var a=0;a<e.length;a++)if("lathe"==e[a].type){var l=-99999,d=[];for(i=e[a].vertices,t=0;t<i.length;t+=2)d.push(new THREE.Vector2(i[t],i[t+1])),i[t+1]>l&&(l=i[t+1]);(r=new THREE.LatheGeometry(d,e[a].segments||8)).applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI,0,0))),r.applyMatrix((new THREE.Matrix4).makeTranslation(0,l,0)),e[a].noise&&s(r,e[a].noise),o.push(r)}else if("extrude"==e[a].type){var c=new THREE.Shape;for(i=e[a].vertices,t=0;t<i.length;t+=2)0==t?c.moveTo(i[t],i[t+1]):c.lineTo(i[t],i[t+1]);(r=new THREE.ExtrudeGeometry(c,{amount:1,bevelEnabled:!1})).applyMatrix((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI/2,0,0))),e[a].noise&&s(r,e[a].noise),o.push(r)}else if("mesh"==e[a].type){r=new THREE.Geometry,i=e[a].vertices;for(var u=e[a].faces,h=0;h<i.length;h+=3)r.vertices.push(new THREE.Vector3(i[h],i[h+1],i[h+2]));for(var p=0;p<u.length;p+=3)r.faces.push(new THREE.Face3(u[p],u[p+1],u[p+2]));this.data.flatShading||e[a].flatShading?r.computeFaceNormals():r.computeVertexNormals(),e[a].mirror&&r.merge(r,(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,Math.PI,0))),e[a].noise&&s(r,e[a].noise),o.push(r)}return o},updateDressing:function(e){var t=new THREE.Object3D,r="dressing"+e,i=this[r],o=this.data[r],s=this.data[r+"Color"],a=this.data[r+"Amount"],l=this.data[r+"Variance"],d=this.data[r+"Scale"],c=this.data[r+"UniformScale"],u=this.data[r+"OnPlayArea"];if(i.setAttribute("visible","none"!=o),"none"!=o){var h,p=new THREE.Geometry;switch(o){case"cubes":(h=[new THREE.BoxGeometry(1,1,1)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"pyramids":(h=[new THREE.ConeGeometry(1,1,4,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"cylinders":(h=[new THREE.CylinderGeometry(.5,.5,1,8,1,!0)])[0].applyMatrix((new THREE.Matrix4).makeTranslation(0,.5,0));break;default:if(!(h=this.getAssetGeometry(this.assets[o])))return}var f=a+Math.floor(this.random()*a);console.log(f);for(var g=0,m=88343;g<f;g++,m++){var y,v=h[Math.floor(this.random(33*e+g)*h.length)],E=d,A=new THREE.Vector3(l.x,l.y,l.z),x=m*e;y=this.random(x)<u?15*this.random(x+1):10+Math.max(A.x,A.z)+10*this.random(x+1)+this.random(x+2)*this.STAGE_SIZE/3;var b=this.random(x+3)*Math.PI*2,_=new THREE.Matrix4,C=this.random(x+4),T=c;_.compose(new THREE.Vector3(Math.cos(b)*y,0,Math.sin(b)*y),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),(this.random(x+5)-.5)*A.length()*Math.PI*2),new THREE.Vector3(E+(T?C:this.random(x+6))*A.x,E+(T?C:this.random(x+7))*A.y,E+(T?C:this.random(x+8))*A.z)),p.merge(v,_)}var S=new THREE.BufferGeometry;S.fromGeometry(p);var w=new THREE.MeshLambertMaterial({color:n(new THREE.Color(s),this.random,this.data.varyColor),vertexColors:THREE.VertexColors});this.data.flatShading&&S.computeVertexNormals();var V=new THREE.Mesh(S,w);t.add(V),i.setObject3D("mesh",t),i.object3D.materialToAnimate=w}},createStars:function(){for(var e=new THREE.BufferGeometry,t=new Float32Array(6e3),r=this.STAGE_SIZE-1,i=new THREE.Vector3,o=0;o<t.length;o+=3)i.set(this.random(o+23)-.5,this.random(o+24),this.random(o+25)-.5),i.normalize(),i.multiplyScalar(r),t[o]=i.x,t[o+1]=i.y,t[o+2]=i.z;e.addAttribute("position",new THREE.BufferAttribute(t,3)),e.setDrawRange(0,0);var n=new THREE.PointsMaterial({size:.01,color:13421772,fog:!1});this.stars.setObject3D("mesh",new THREE.Points(e,n))},setStars:function(e){this.stars||(this.stars=document.createElement("a-entity"),this.stars.id="stars",this.createStars(),this.el.appendChild(this.stars)),e=Math.floor(Math.min(2e3,Math.max(0,e))),this.stars.getObject3D("mesh").geometry.setDrawRange(0,e)}}),AFRAME.registerShader("skyshader",{schema:{luminance:{type:"number",default:1,min:0,max:2,is:"uniform"},turbidity:{type:"number",default:2,min:0,max:20,is:"uniform"},reileigh:{type:"number",default:1,min:0,max:4,is:"uniform"},mieCoefficient:{type:"number",default:.005,min:0,max:.1,is:"uniform"},mieDirectionalG:{type:"number",default:.8,min:0,max:1,is:"uniform"},sunPosition:{type:"vec3",default:{x:0,y:0,z:-1},is:"uniform"},color:{type:"color",default:"#fff"}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","varying vec3 vWorldPosition;","vec3 cameraPos = vec3(0., 0., 0.);","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float pn = 0.035;","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3(0.0, 1.0, 0.0);","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{   ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up));","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","vec3 Fex = exp(-(betaR * sR + betaM * sM));","float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));","vec3 direction = normalize(vWorldPosition - cameraPos);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","vec3 L0 = vec3(0.1) * Fex;","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1.0;","}"].join("\n")}),AFRAME.registerShader("gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:["varying vec3 vWorldPosition;","void main() {"," vec4 worldPosition = modelMatrix * vec4( position, 1.0 );"," vWorldPosition = worldPosition.xyz;"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 bottomColor;","uniform vec3 topColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {"," float h = normalize( vWorldPosition ).y;"," gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );","}"].join("\n")});var o=function(e){var t;for(null==e&&(e=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],t=0;t<256;t++)this.p[t]=Math.floor(256*e.random(666));for(this.perm=[],t=0;t<512;t++)this.perm[t]=this.p[255&t]};function n(e,t,r){return r?(t(1)<.5?e.r+=.2*t(2):e.r-=.2*t(3),t(4)<.5?e.g+=.2*t(5):e.g-=.2*t(6),t(7)<.5?e.b+=.2*t(8):e.b-=.2*t(9),e):e}o.prototype.dot=function(e,t,r,i){return e[0]*t+e[1]*r+e[2]*i},o.prototype.mix=function(e,t,r){return(1-r)*e+r*t},o.prototype.fade=function(e){return e*e*e*(e*(6*e-15)+10)},o.prototype.noise=function(e,t,r){var i=Math.floor(e),o=Math.floor(t),n=Math.floor(r);e-=i,t-=o,r-=n,i&=255,o&=255,n&=255;var s=this.perm[i+this.perm[o+this.perm[n]]]%12,a=this.perm[i+this.perm[o+this.perm[n+1]]]%12,l=this.perm[i+this.perm[o+1+this.perm[n]]]%12,d=this.perm[i+this.perm[o+1+this.perm[n+1]]]%12,c=this.perm[i+1+this.perm[o+this.perm[n]]]%12,u=this.perm[i+1+this.perm[o+this.perm[n+1]]]%12,h=this.perm[i+1+this.perm[o+1+this.perm[n]]]%12,p=this.perm[i+1+this.perm[o+1+this.perm[n+1]]]%12,f=this.dot(this.grad3[s],e,t,r),g=this.dot(this.grad3[c],e-1,t,r),m=this.dot(this.grad3[l],e,t-1,r),y=this.dot(this.grad3[h],e-1,t-1,r),v=this.dot(this.grad3[a],e,t,r-1),E=this.dot(this.grad3[u],e-1,t,r-1),A=this.dot(this.grad3[d],e,t-1,r-1),x=this.dot(this.grad3[p],e-1,t-1,r-1),b=this.fade(e),_=this.fade(t),C=this.fade(r),T=this.mix(f,g,b),S=this.mix(v,E,b),w=this.mix(m,y,b),V=this.mix(A,x,b),R=this.mix(T,w,_),O=this.mix(S,V,_);return this.mix(R,O,C)};{const t=["environment"],r=["skyshader","gradientshader"],i=[];e.hot.dispose(e=>{e.needsReplace=!0,t.forEach(e=>{delete AFRAME.components[e];const t=AFRAME.scenes[0].querySelectorAll(`[${e}]`);for(let r=0;r<t.length;r++)t[r].isEntity&&(t[r].setAttribute(`data-__hot-${e}`,JSON.stringify(t[r].getDOMAttribute(e))),t[r].removeAttribute(e))}),r.forEach(e=>{delete AFRAME.shaders[e];const t=AFRAME.scenes[0].querySelectorAll("[material]");for(let r=0;r<t.length;r++)t[r].isEntity&&t[r].getAttribute("material").shader===e&&(t[r].setAttribute("data-__hot-material",JSON.stringify(t[r].getDOMAttribute("material"))),t[r].removeAttribute("material"))}),i.forEach(e=>{delete AFRAME.systems[e],delete AFRAME.scenes[0].systems[e]})}),e.hot.data&&e.hot.data.needsReplace&&(t.forEach(e=>{const t=`data-__hot-${e}`,r=document.querySelectorAll(`[${t}]`);for(let i=0;i<r.length;i++)r[i].setAttribute(e,JSON.parse(r[i].getAttribute(t))),r[i].removeAttribute(t)}),t.forEach(e=>{const t=document.querySelectorAll("[data-__hot-material]");for(let e=0;e<t.length;e++)t[e].setAttribute("material",JSON.parse(t[e].getAttribute("data-__hot-material"))),t[e].removeAttribute("data-__hot-material")})),e.hot.accept()}},function(e,t,r){AFRAME.registerShader("noise",{schema:{time:{type:"time",is:"uniform"},color:{type:"color",is:"uniform",default:"red"},weight:{type:"number",default:1,is:"uniform"}},vertexShader:r(4),fragmentShader:r(5)});{const t=[],r=["noise"],i=[];e.hot.dispose(e=>{e.needsReplace=!0,t.forEach(e=>{delete AFRAME.components[e];const t=AFRAME.scenes[0].querySelectorAll(`[${e}]`);for(let r=0;r<t.length;r++)t[r].isEntity&&(t[r].setAttribute(`data-__hot-${e}`,JSON.stringify(t[r].getDOMAttribute(e))),t[r].removeAttribute(e))}),r.forEach(e=>{delete AFRAME.shaders[e];const t=AFRAME.scenes[0].querySelectorAll("[material]");for(let r=0;r<t.length;r++)t[r].isEntity&&t[r].getAttribute("material").shader===e&&(t[r].setAttribute("data-__hot-material",JSON.stringify(t[r].getDOMAttribute("material"))),t[r].removeAttribute("material"))}),i.forEach(e=>{delete AFRAME.systems[e],delete AFRAME.scenes[0].systems[e]})}),e.hot.data&&e.hot.data.needsReplace&&(t.forEach(e=>{const t=`data-__hot-${e}`,r=document.querySelectorAll(`[${t}]`);for(let i=0;i<r.length;i++)r[i].setAttribute(e,JSON.parse(r[i].getAttribute(t))),r[i].removeAttribute(t)}),t.forEach(e=>{const t=document.querySelectorAll("[data-__hot-material]");for(let e=0;e<t.length;e++)t[e].setAttribute("material",JSON.parse(t[e].getAttribute("data-__hot-material"))),t[e].removeAttribute("data-__hot-material")})),e.hot.accept()}},function(e,t){e.exports="vec3 mod289(vec3 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise, periodic variant\nfloat pnoise(vec3 P, vec3 rep)\n{\n  vec3 Pi0 = mod(floor(P), rep); // Integer part, modulo period\n  vec3 Pi1 = mod(Pi0 + vec3(1.0), rep); // Integer part + 1, mod period\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\n  float f( vec3 p ) {\n    return pnoise( vec3( p ), vec3( 10.0, 10.0, 10.0 ) );\n  }\n\n  varying vec3 vNormal;\n  varying vec3 vReflect;\n  varying float ao;\n  uniform float time;\n  uniform float weight;\n\n  float fround( float value ) {\n    return floor( value + 0.5 );\n  }\n\n  vec3 v3round( vec3 value ) {\n    return vec3( fround( value.x ), fround( value.y ), fround( value.z ) );\n  }\n\n  void main() {\n\n    vec3 evNormal = normal;\n    vec3 aniNormal = 2.0 * evNormal + time / 1000.0;\n    float f0 = weight * f( aniNormal );\n    float fx = weight * f( aniNormal + vec3( .0001, 0.0, 0.0 ) );\n    float fy = weight * f( aniNormal + vec3( 0.0, .0001, 0.0 ) );\n    float fz = weight * f( aniNormal + vec3( 0.0, 0.0, .0001 ) );\n    vec3 modifiedNormal = normalize( evNormal - vec3( (fx - f0) / .0001, (fy - f0) / .0001, (fz - f0) / .0001 ) );\n\n    if( weight > 0.0 ) {\n      ao = f0 / weight;\n    } else {\n      ao = 0.0;\n    }\n    vNormal = modifiedNormal;\n    vec3 newPosition = position + f0 * evNormal;\n    vec3 nWorld = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * modifiedNormal );\n    vReflect = normalize( reflect( normalize( newPosition.xyz - cameraPosition ), nWorld ) );\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( newPosition, 1.0 );\n  }\n"},function(e,t){e.exports="varying vec3 vNormal;\nvarying vec3 vReflect;\nvarying float ao;\nuniform vec3 color;\n\nfloat PI = 3.14159265358979323846264;\n\nvoid main() {\n\n  float yaw = .5 - atan( vReflect.z, - vReflect.x ) / ( 2.0 * PI );\n  float pitch = .5 - asin( vReflect.y ) / PI;\n  vec2 pos = vec2( yaw, pitch );\n  float diffuse_value1 = .0015 * max(dot(vNormal, vec3( -490.0, 29.8, -85.8 ) ), 0.0);\n  float diffuse_value2 = .0005 * max(dot(vNormal, vec3( -460.0, 40.27, 187.4 ) ), 0.0);\n  float diffuse_value3 = .0010 * max(dot(vNormal, vec3( 175.5, 30.04, 466.4 ) ), 0.0);\n  float diffuse_value4 = .0005 * max(dot(vNormal, vec3( 466.0, 45.3, 172.9 ) ), 0.0);\n\n  gl_FragColor = vec4( color - .15 * ao + .5 * vec3( diffuse_value1 + diffuse_value2 + diffuse_value3 + diffuse_value4 ), 1.0 );\n}\n"},function(e,t,r){AFRAME.registerComponent("spin",{init:function(){this.originalRotation=this.el.object3D.rotation.y},remove:function(){this.el.object3D.rotation.y=this.originalRotation},tick:function(){this.el.object3D.rotation.y+=.05}});{const t=["spin"],r=[],i=[];e.hot.dispose(e=>{e.needsReplace=!0,t.forEach(e=>{delete AFRAME.components[e];const t=AFRAME.scenes[0].querySelectorAll(`[${e}]`);for(let r=0;r<t.length;r++)t[r].isEntity&&(t[r].setAttribute(`data-__hot-${e}`,JSON.stringify(t[r].getDOMAttribute(e))),t[r].removeAttribute(e))}),r.forEach(e=>{delete AFRAME.shaders[e];const t=AFRAME.scenes[0].querySelectorAll("[material]");for(let r=0;r<t.length;r++)t[r].isEntity&&t[r].getAttribute("material").shader===e&&(t[r].setAttribute("data-__hot-material",JSON.stringify(t[r].getDOMAttribute("material"))),t[r].removeAttribute("material"))}),i.forEach(e=>{delete AFRAME.systems[e],delete AFRAME.scenes[0].systems[e]})}),e.hot.data&&e.hot.data.needsReplace&&(t.forEach(e=>{const t=`data-__hot-${e}`,r=document.querySelectorAll(`[${t}]`);for(let i=0;i<r.length;i++)r[i].setAttribute(e,JSON.parse(r[i].getAttribute(t))),r[i].removeAttribute(t)}),t.forEach(e=>{const t=document.querySelectorAll("[data-__hot-material]");for(let e=0;e<t.length;e++)t[e].setAttribute("material",JSON.parse(t[e].getAttribute("data-__hot-material"))),t[e].removeAttribute("data-__hot-material")})),e.hot.accept()}},function(e,t,r){var i=r(8);if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("particle-system",{schema:{preset:{type:"string",default:"",oneOf:["default","dust","snow","rain"]},maxAge:{type:"number",default:6},positionSpread:{type:"vec3",default:{x:0,y:0,z:0}},type:{type:"number",default:i.distributions.BOX},rotationAxis:{type:"string",default:"x"},rotationAngle:{type:"number",default:0},rotationAngleSpread:{type:"number",default:0},accelerationValue:{type:"vec3",default:{x:0,y:-10,z:0}},accelerationSpread:{type:"vec3",default:{x:10,y:0,z:10}},velocityValue:{type:"vec3",default:{x:0,y:25,z:0}},velocitySpread:{type:"vec3",default:{x:10,y:7.5,z:10}},dragValue:{type:"number",default:0},dragSpread:{type:"number",default:0},dragRandomise:{type:"boolean",default:!1},color:{type:"array",default:["#0000FF","#FF0000"]},size:{type:"number",default:1},direction:{type:"number",default:1},duration:{type:"number",default:null},particleCount:{type:"number",default:1e3},texture:{type:"asset",default:"https://cdn.rawgit.com/IdeaSpaceVR/aframe-particle-system-component/master/dist/images/star2.png"},randomise:{type:"boolean",default:!1},opacity:{type:"array",default:["1"]},maxParticleCount:{type:"number",default:25e4},blending:{type:"number",default:THREE.AdditiveBlending,oneOf:[THREE.NoBlending,THREE.NormalBlending,THREE.AdditiveBlending,THREE.SubtractiveBlending,THREE.MultiplyBlending]},enabled:{type:"boolean",default:!0}},init:function(){this.presets={},this.presets.dust={maxAge:20,positionSpread:{x:100,y:100,z:100},rotationAngle:3.14,accelerationValue:{x:0,y:0,z:0},accelerationSpread:{x:0,y:0,z:0},velocityValue:{x:1,y:.3,z:1},velocitySpread:{x:.5,y:1,z:.5},color:["#FFFFFF"],particleCount:100,texture:"https://cdn.rawgit.com/IdeaSpaceVR/aframe-particle-system-component/master/dist/images/smokeparticle.png"},this.presets.snow={maxAge:20,positionSpread:{x:100,y:100,z:100},rotationAngle:3.14,accelerationValue:{x:0,y:0,z:0},accelerationSpread:{x:.2,y:0,z:.2},velocityValue:{x:0,y:8,z:0},velocitySpread:{x:2,y:0,z:2},color:["#FFFFFF"],particleCount:200,texture:"https://cdn.rawgit.com/IdeaSpaceVR/aframe-particle-system-component/master/dist/images/smokeparticle.png"},this.presets.rain={maxAge:1,positionSpread:{x:100,y:100,z:100},rotationAngle:3.14,accelerationValue:{x:0,y:3,z:0},accelerationSpread:{x:2,y:1,z:2},velocityValue:{x:0,y:75,z:0},velocitySpread:{x:10,y:50,z:10},color:["#FFFFFF"],size:.4,texture:"https://cdn.rawgit.com/IdeaSpaceVR/aframe-particle-system-component/master/dist/images/raindrop.png"}},update:function(e){for(var t in this.particleGroup&&this.el.removeObject3D("particle-system"),this.preset=this.presets[this.data.preset]||{},this.data)this.data[t]=this.applyPreset(t);this.initParticleSystem(this.data),!0===this.data.enabled?this.startParticles():this.stopParticles()},applyPreset:function(e){return!this.attrValue[e]&&this.preset[e]?this.preset[e]:this.data[e]},tick:function(e,t){this.particleGroup.tick(t/1e3)},remove:function(){this.particleGroup&&this.el.removeObject3D("particle-system")},startParticles:function(){this.particleGroup.emitters.forEach(function(e){e.enable()})},stopParticles:function(){this.particleGroup.emitters.forEach(function(e){e.disable()})},initParticleSystem:function(e){var t=(new THREE.TextureLoader).load(e.texture,function(e){return e},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error occurred")});this.particleGroup=new i.Group({texture:{value:t},maxParticleCount:e.maxParticleCount,blending:e.blending});var r=new i.Emitter({maxAge:{value:e.maxAge},type:{value:e.type},position:{spread:new THREE.Vector3(e.positionSpread.x,e.positionSpread.y,e.positionSpread.z),randomise:e.randomise},rotation:{axis:"x"==e.rotationAxis?new THREE.Vector3(1,0,0):"y"==e.rotationAxis?new THREE.Vector3(0,1,0):"z"==e.rotationAxis?new THREE.Vector3(0,0,1):new THREE.Vector3(0,1,0),angle:e.rotationAngle,angleSpread:e.rotationAngleSpread,static:!0},acceleration:{value:new THREE.Vector3(e.accelerationValue.x,e.accelerationValue.y,e.accelerationValue.z),spread:new THREE.Vector3(e.accelerationSpread.x,e.accelerationSpread.y,e.accelerationSpread.z)},velocity:{value:new THREE.Vector3(e.velocityValue.x,e.velocityValue.y,e.velocityValue.z),spread:new THREE.Vector3(e.velocitySpread.x,e.velocitySpread.y,e.velocitySpread.z)},drag:{value:new THREE.Vector3(e.dragValue.x,e.dragValue.y,e.dragValue.z),spread:new THREE.Vector3(e.dragSpread.x,e.dragSpread.y,e.dragSpread.z),randomise:e.dragRandomise},color:{value:e.color.map(function(e){return new THREE.Color(e)})},size:{value:e.size},direction:{value:e.direction},duration:e.duration,opacity:{value:e.opacity.map(function(e){return parseFloat(e)})},particleCount:e.particleCount});this.particleGroup.addEmitter(r),this.particleGroup.mesh.frustumCulled=!1,this.el.setObject3D("particle-system",this.particleGroup.mesh)}})},function(e,t,r){var i,o,n={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};void 0===(o="function"==typeof(i=n)?i.call(t,r,t,e):i)||(e.exports=o),n.TypedArrayHelper=function(e,t,r,i){"use strict";this.componentSize=r||1,this.size=t||1,this.TypedArrayConstructor=e||Float32Array,this.array=new e(t*this.componentSize),this.indexOffset=i||0},n.TypedArrayHelper.constructor=n.TypedArrayHelper,n.TypedArrayHelper.prototype.setSize=function(e,t){"use strict";var r=this.array.length;return t||(e*=this.componentSize),e<r?this.shrink(e):e>r?this.grow(e):void console.info("TypedArray is already of size:",e+".","Will not resize.")},n.TypedArrayHelper.prototype.shrink=function(e){"use strict";return this.array=this.array.subarray(0,e),this.size=e,this},n.TypedArrayHelper.prototype.grow=function(e){"use strict";var t=this.array,r=new this.TypedArrayConstructor(e);return r.set(t),this.array=r,this.size=e,this},n.TypedArrayHelper.prototype.splice=function(e,t){"use strict";e*=this.componentSize,t*=this.componentSize;for(var r=[],i=this.array,o=i.length,n=0;n<o;++n)(n<e||n>=t)&&r.push(i[n]);return this.setFromArray(0,r),this},n.TypedArrayHelper.prototype.setFromArray=function(e,t){"use strict";var r=e+t.length;return r>this.array.length?this.grow(r):r<this.array.length&&this.shrink(r),this.array.set(t,this.indexOffset+e),this},n.TypedArrayHelper.prototype.setVec2=function(e,t){"use strict";return this.setVec2Components(e,t.x,t.y)},n.TypedArrayHelper.prototype.setVec2Components=function(e,t,r){"use strict";var i=this.array,o=this.indexOffset+e*this.componentSize;return i[o]=t,i[o+1]=r,this},n.TypedArrayHelper.prototype.setVec3=function(e,t){"use strict";return this.setVec3Components(e,t.x,t.y,t.z)},n.TypedArrayHelper.prototype.setVec3Components=function(e,t,r,i){"use strict";var o=this.array,n=this.indexOffset+e*this.componentSize;return o[n]=t,o[n+1]=r,o[n+2]=i,this},n.TypedArrayHelper.prototype.setVec4=function(e,t){"use strict";return this.setVec4Components(e,t.x,t.y,t.z,t.w)},n.TypedArrayHelper.prototype.setVec4Components=function(e,t,r,i,o){"use strict";var n=this.array,s=this.indexOffset+e*this.componentSize;return n[s]=t,n[s+1]=r,n[s+2]=i,n[s+3]=o,this},n.TypedArrayHelper.prototype.setMat3=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},n.TypedArrayHelper.prototype.setMat4=function(e,t){"use strict";return this.setFromArray(this.indexOffset+e*this.componentSize,t.elements)},n.TypedArrayHelper.prototype.setColor=function(e,t){"use strict";return this.setVec3Components(e,t.r,t.g,t.b)},n.TypedArrayHelper.prototype.setNumber=function(e,t){"use strict";return this.array[this.indexOffset+e*this.componentSize]=t,this},n.TypedArrayHelper.prototype.getValueAtIndex=function(e){"use strict";return this.array[this.indexOffset+e]},n.TypedArrayHelper.prototype.getComponentValueAtIndex=function(e){"use strict";return this.array.subarray(this.indexOffset+e*this.componentSize)},n.ShaderAttribute=function(e,t,r){"use strict";var i=n.ShaderAttribute.typeSizeMap;this.type="string"==typeof e&&i.hasOwnProperty(e)?e:"f",this.componentSize=i[this.type],this.arrayType=r||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!t,this.updateMin=0,this.updateMax=0},n.ShaderAttribute.constructor=n.ShaderAttribute,n.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},n.ShaderAttribute.prototype.setUpdateRange=function(e,t){"use strict";this.updateMin=Math.min(e*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(t*this.componentSize,this.updateMax*this.componentSize)},n.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var e=this.bufferAttribute,t=e.updateRange;t.offset=this.updateMin,t.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),e.needsUpdate=!0},n.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},n.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.dynamic=this.dynamicBuffer},n.ShaderAttribute.prototype.splice=function(e,t){"use strict";this.typedArray.splice(e,t),this.forceUpdateAll()},n.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},n.ShaderAttribute.prototype._ensureTypedArray=function(e){"use strict";null!==this.typedArray&&this.typedArray.size===e*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==e?this.typedArray.setSize(e):null===this.typedArray&&(this.typedArray=new n.TypedArrayHelper(this.arrayType,e,this.componentSize)))},n.ShaderAttribute.prototype._createBufferAttribute=function(e){"use strict";if(this._ensureTypedArray(e),null!==this.bufferAttribute)return this.bufferAttribute.array=this.typedArray.array,void(this.bufferAttribute.needsUpdate=!0);this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),this.bufferAttribute.dynamic=this.dynamicBuffer},n.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},n.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D texture;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( texture, vUv );"].join("\n")},n.shaders={vertex:[n.shaderChunks.defines,n.shaderChunks.uniforms,n.shaderChunks.attributes,n.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,THREE.ShaderChunk.fog_pars_vertex,n.shaderChunks.branchAvoidanceFunctions,n.shaderChunks.unpackColor,n.shaderChunks.unpackRotationAxis,n.shaderChunks.floatOverLifetime,n.shaderChunks.colorOverLifetime,n.shaderChunks.paramFetchingFunctions,n.shaderChunks.forceFetchingFunctions,n.shaderChunks.rotationFunctions,"vec4 mvPosition;","void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPos = mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPos.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPos;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[n.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,n.shaderChunks.varyings,n.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",n.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",THREE.ShaderChunk.fog_fragment,"}"].join("\n")},n.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(e,t,r){"use strict";return typeof e===t?e:r},ensureArrayTypedArg:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(typeof e[i]!==t)return r;return e}return this.ensureTypedArg(e,t,r)},ensureInstanceOf:function(e,t,r){"use strict";return void 0!==t&&e instanceof t?e:r},ensureArrayInstanceOf:function(e,t,r){"use strict";if(Array.isArray(e)){for(var i=e.length-1;i>=0;--i)if(void 0!==t&&e[i]instanceof t==!1)return r;return e}return this.ensureInstanceOf(e,t,r)},ensureValueOverLifetimeCompliance:function(e,t,r){"use strict";t=t||3,r=r||3,!1===Array.isArray(e._value)&&(e._value=[e._value]),!1===Array.isArray(e._spread)&&(e._spread=[e._spread]);var i=this.clamp(e._value.length,t,r),o=this.clamp(e._spread.length,t,r),n=Math.max(i,o);e._value.length!==n&&(e._value=this.interpolateArray(e._value,n)),e._spread.length!==n&&(e._spread=this.interpolateArray(e._spread,n))},interpolateArray:function(e,t){"use strict";for(var r=e.length,i=["function"==typeof e[0].clone?e[0].clone():e[0]],o=(r-1)/(t-1),n=1;n<t-1;++n){var s=n*o,a=Math.floor(s),l=Math.ceil(s),d=s-a;i[n]=this.lerpTypeAgnostic(e[a],e[l],d)}return i.push("function"==typeof e[r-1].clone?e[r-1].clone():e[r-1]),i},clamp:function(e,t,r){"use strict";return Math.max(t,Math.min(e,r))},zeroToEpsilon:function(e,t){"use strict";var r=e;return r=t?1e-5*Math.random()*10:1e-5,e<0&&e>-1e-5&&(r=-r),r},lerpTypeAgnostic:function(e,t,r){"use strict";var i,o=this.types;return typeof e===o.NUMBER&&typeof t===o.NUMBER?e+(t-e)*r:e instanceof THREE.Vector2&&t instanceof THREE.Vector2?((i=e.clone()).x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i):e instanceof THREE.Vector3&&t instanceof THREE.Vector3?((i=e.clone()).x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i):e instanceof THREE.Vector4&&t instanceof THREE.Vector4?((i=e.clone()).x=this.lerp(e.x,t.x,r),i.y=this.lerp(e.y,t.y,r),i.z=this.lerp(e.z,t.z,r),i.w=this.lerp(e.w,t.w,r),i):e instanceof THREE.Color&&t instanceof THREE.Color?((i=e.clone()).r=this.lerp(e.r,t.r,r),i.g=this.lerp(e.g,t.g,r),i.b=this.lerp(e.b,t.b,r),i):void console.warn("Invalid argument types, or argument types do not match:",e,t)},lerp:function(e,t,r){"use strict";return e+(t-e)*r},roundToNearestMultiple:function(e,t){"use strict";var r;return 0===t?e:0===(r=Math.abs(e)%t)?e:e<0?-(Math.abs(e)-r):e+t-r},arrayValuesAreEqual:function(e){"use strict";for(var t=0;t<e.length-1;++t)if(e[t]!==e[t+1])return!1;return!0},randomFloat:function(e,t){"use strict";return e+t*(Math.random()-.5)},randomVector3:function(e,t,r,i,o){"use strict";var n=r.x+(Math.random()*i.x-.5*i.x),s=r.y+(Math.random()*i.y-.5*i.y),a=r.z+(Math.random()*i.z-.5*i.z);o&&(n=.5*-o.x+this.roundToNearestMultiple(n,o.x),s=.5*-o.y+this.roundToNearestMultiple(s,o.y),a=.5*-o.z+this.roundToNearestMultiple(a,o.z)),e.typedArray.setVec3Components(t,n,s,a)},randomColor:function(e,t,r,i){"use strict";var o=r.r+Math.random()*i.x,n=r.g+Math.random()*i.y,s=r.b+Math.random()*i.z;o=this.clamp(o,0,1),n=this.clamp(n,0,1),s=this.clamp(s,0,1),e.typedArray.setVec3Components(t,o,n,s)},randomColorAsHex:function(){"use strict";var e=new THREE.Color;return function(t,r,i,o){for(var n=i.length,s=[],a=0;a<n;++a){var l=o[a];e.copy(i[a]),e.r+=Math.random()*l.x-.5*l.x,e.g+=Math.random()*l.y-.5*l.y,e.b+=Math.random()*l.z-.5*l.z,e.r=this.clamp(e.r,0,1),e.g=this.clamp(e.g,0,1),e.b=this.clamp(e.b,0,1),s.push(e.getHex())}t.typedArray.setVec4Components(r,s[0],s[1],s[2],s[3])}}(),randomVector3OnSphere:function(e,t,r,i,o,n,s,a){"use strict";var l=2*Math.random()-1,d=6.2832*Math.random(),c=Math.sqrt(1-l*l),u=this.randomFloat(i,o),h=0,p=0,f=0;s&&(u=Math.round(u/s)*s),h=c*Math.cos(d)*u,p=c*Math.sin(d)*u,f=l*u,h*=n.x,p*=n.y,f*=n.z,h+=r.x,p+=r.y,f+=r.z,e.typedArray.setVec3Components(t,h,p,f)},seededRandom:function(e){var t=1e4*Math.sin(e);return t-(0|t)},randomVector3OnDisc:function(e,t,r,i,o,n,s){"use strict";var a=6.2832*Math.random(),l=Math.abs(this.randomFloat(i,o)),d=0,c=0,u=0;s&&(l=Math.round(l/s)*s),d=Math.cos(a)*l,c=Math.sin(a)*l,d*=n.x,c*=n.y,d+=r.x,c+=r.y,u+=r.z,e.typedArray.setVec3Components(t,d,c,u)},randomDirectionVector3OnSphere:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,o,n,s,a,l){e.copy(s),e.x-=i,e.y-=o,e.z-=n,e.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(r,e.x,e.y,e.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var e=new THREE.Vector3;return function(t,r,i,o,n,s,a,l){e.copy(s),e.x-=i,e.y-=o,e.z-=n,e.normalize().multiplyScalar(-this.randomFloat(a,l)),t.typedArray.setVec3Components(r,e.x,e.y,0)}}(),getPackedRotationAxis:function(){"use strict";var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Color,i=new THREE.Vector3(1,1,1);return function(o,n){return e.copy(o).normalize(),t.copy(n).normalize(),e.x+=.5*-n.x+Math.random()*n.x,e.y+=.5*-n.y+Math.random()*n.y,e.z+=.5*-n.z+Math.random()*n.z,e.normalize().add(i).multiplyScalar(.5),r.setRGB(e.x,e.y,e.z),r.getHex()}}()},n.Group=function(e){"use strict";var t=n.utils,r=t.types;(e=t.ensureTypedArg(e,r.OBJECT,{})).texture=t.ensureTypedArg(e.texture,r.OBJECT,{}),this.uuid=THREE.Math.generateUUID(),this.fixedTimeStep=t.ensureTypedArg(e.fixedTimeStep,r.NUMBER,.016),this.texture=t.ensureInstanceOf(e.texture.value,THREE.Texture,null),this.textureFrames=t.ensureInstanceOf(e.texture.frames,THREE.Vector2,new THREE.Vector2(1,1)),this.textureFrameCount=t.ensureTypedArg(e.texture.frameCount,r.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=t.ensureTypedArg(e.texture.loop,r.NUMBER,1),this.textureFrames.max(new THREE.Vector2(1,1)),this.hasPerspective=t.ensureTypedArg(e.hasPerspective,r.BOOLEAN,!0),this.colorize=t.ensureTypedArg(e.colorize,r.BOOLEAN,!0),this.maxParticleCount=t.ensureTypedArg(e.maxParticleCount,r.NUMBER,null),this.blending=t.ensureTypedArg(e.blending,r.NUMBER,THREE.AdditiveBlending),this.transparent=t.ensureTypedArg(e.transparent,r.BOOLEAN,!0),this.alphaTest=parseFloat(t.ensureTypedArg(e.alphaTest,r.NUMBER,0)),this.depthWrite=t.ensureTypedArg(e.depthWrite,r.BOOLEAN,!1),this.depthTest=t.ensureTypedArg(e.depthTest,r.BOOLEAN,!0),this.fog=t.ensureTypedArg(e.fog,r.BOOLEAN,!0),this.scale=t.ensureTypedArg(e.scale,r.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:n.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new n.ShaderAttribute("v3",!0),acceleration:new n.ShaderAttribute("v4",!0),velocity:new n.ShaderAttribute("v3",!0),rotation:new n.ShaderAttribute("v4",!0),rotationCenter:new n.ShaderAttribute("v3",!0),params:new n.ShaderAttribute("v4",!0),size:new n.ShaderAttribute("v4",!0),angle:new n.ShaderAttribute("v4",!0),color:new n.ShaderAttribute("v4",!0),opacity:new n.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:n.shaders.vertex,fragmentShader:n.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new THREE.BufferGeometry,this.mesh=new THREE.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},n.Group.constructor=n.Group,n.Group.prototype._updateDefines=function(){"use strict";for(var e,t=this.emitters,r=t.length-1,i=this.defines;r>=0;--r)e=t[r],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread);this.material.needsUpdate=!0},n.Group.prototype._applyAttributesToGeometry=function(){"use strict";var e,t,r=this.attributes,i=this.geometry,o=i.attributes;for(var n in r)r.hasOwnProperty(n)&&(e=r[n],(t=o[n])?t.array=e.typedArray.array:i.addAttribute(n,e.bufferAttribute),e.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},n.Group.prototype.addEmitter=function(e){"use strict";if(e instanceof n.Emitter!=!1)if(this.emitterIDs.indexOf(e.uuid)>-1)console.error("Emitter already exists in this group. Will not add again.");else{if(null===e.group){var t=this.attributes,r=this.particleCount,i=r+e.particleCount;for(var o in this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),e._calculatePPSValue(e.maxAge._value+e.maxAge._spread),e._setBufferUpdateRanges(this.attributeKeys),e._setAttributeOffset(r),e.group=this,e.attributes=this.attributes,t)t.hasOwnProperty(o)&&t[o]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var s=r;s<i;++s)e._assignPositionValue(s),e._assignForceValue(s,"velocity"),e._assignForceValue(s,"acceleration"),e._assignAbsLifetimeValue(s,"opacity"),e._assignAbsLifetimeValue(s,"size"),e._assignAngleValue(s),e._assignRotationValue(s),e._assignParamsValue(s),e._assignColorValue(s);return this._applyAttributesToGeometry(),this.emitters.push(e),this.emitterIDs.push(e.uuid),this._updateDefines(e),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this}console.error("Emitter already belongs to another group. Will not add to requested group.")}else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},n.Group.prototype.removeEmitter=function(e){"use strict";var t=this.emitterIDs.indexOf(e.uuid);if(e instanceof n.Emitter!=!1)if(-1!==t){for(var r=e.attributeOffset,i=r+e.particleCount,o=this.attributes.params.typedArray,s=r;s<i;++s)o.array[4*s]=0,o.array[4*s+1]=0;for(var a in this.emitters.splice(t,1),this.emitterIDs.splice(t,1),this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(r,i);this.particleCount-=e.particleCount,e._onRemove(),this._attributesNeedRefresh=!0}else console.error("Emitter does not exist in this group. Will not remove.");else console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",e)},n.Group.prototype.getFromPool=function(){"use strict";var e=this._pool,t=this._createNewWhenPoolEmpty;return e.length?e.pop():t?new n.Emitter(this._poolCreationSettings):null},n.Group.prototype.releaseIntoPool=function(e){"use strict";if(e instanceof n.Emitter!=!1)return e.reset(),this._pool.unshift(e),this;console.error("Argument is not instanceof SPE.Emitter:",e)},n.Group.prototype.getPool=function(){"use strict";return this._pool},n.Group.prototype.addPool=function(e,t,r){"use strict";var i;this._poolCreationSettings=t,this._createNewWhenPoolEmpty=!!r;for(var o=0;o<e;++o)i=Array.isArray(t)?new n.Emitter(t[o]):new n.Emitter(t),this.addEmitter(i),this.releaseIntoPool(i);return this},n.Group.prototype._triggerSingleEmitter=function(e){"use strict";var t=this.getFromPool(),r=this;if(null!==t)return e instanceof THREE.Vector3&&(t.position.value.copy(e),t.position.value=t.position.value),t.enable(),setTimeout(function(){t.disable(),r.releaseIntoPool(t)},1e3*Math.max(t.duration,t.maxAge.value+t.maxAge.spread)),this;console.log("SPE.Group pool ran out.")},n.Group.prototype.triggerPoolEmitter=function(e,t){"use strict";if("number"==typeof e&&e>1)for(var r=0;r<e;++r)this._triggerSingleEmitter(t);else this._triggerSingleEmitter(t);return this},n.Group.prototype._updateUniforms=function(e){"use strict";this.uniforms.runTime.value+=e,this.uniforms.deltaTime.value=e},n.Group.prototype._resetBufferRanges=function(){"use strict";for(var e=this.attributeKeys,t=this.attributeCount-1,r=this.attributes;t>=0;--t)r[e[t]].resetUpdateRange()},n.Group.prototype._updateBuffers=function(e){"use strict";for(var t,r,i,o=this.attributeKeys,n=this.attributeCount-1,s=this.attributes,a=e.bufferUpdateRanges;n>=0;--n)r=a[t=o[n]],(i=s[t]).setUpdateRange(r.min,r.max),i.flagUpdate()},n.Group.prototype.tick=function(e){"use strict";var t=this.emitters,r=t.length,i=e||this.fixedTimeStep,o=this.attributeKeys,n=this.attributes;if(this._updateUniforms(i),this._resetBufferRanges(),0!==r||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(var s,a=0;a<r;++a)(s=t[a]).tick(i),this._updateBuffers(s);if(!0===this._attributesNeedDynamicReset){for(a=this.attributeCount-1;a>=0;--a)n[o[a]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(a=this.attributeCount-1;a>=0;--a)n[o[a]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},n.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},n.Emitter=function(e){"use strict";var t=n.utils,r=t.types,i=n.valueOverLifetimeLength;for(var o in(e=t.ensureTypedArg(e,r.OBJECT,{})).position=t.ensureTypedArg(e.position,r.OBJECT,{}),e.velocity=t.ensureTypedArg(e.velocity,r.OBJECT,{}),e.acceleration=t.ensureTypedArg(e.acceleration,r.OBJECT,{}),e.radius=t.ensureTypedArg(e.radius,r.OBJECT,{}),e.drag=t.ensureTypedArg(e.drag,r.OBJECT,{}),e.rotation=t.ensureTypedArg(e.rotation,r.OBJECT,{}),e.color=t.ensureTypedArg(e.color,r.OBJECT,{}),e.opacity=t.ensureTypedArg(e.opacity,r.OBJECT,{}),e.size=t.ensureTypedArg(e.size,r.OBJECT,{}),e.angle=t.ensureTypedArg(e.angle,r.OBJECT,{}),e.wiggle=t.ensureTypedArg(e.wiggle,r.OBJECT,{}),e.maxAge=t.ensureTypedArg(e.maxAge,r.OBJECT,{}),e.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=THREE.Math.generateUUID(),this.type=t.ensureTypedArg(e.type,r.NUMBER,n.distributions.BOX),this.position={_value:t.ensureInstanceOf(e.position.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:t.ensureInstanceOf(e.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.position.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1),_radius:t.ensureTypedArg(e.position.radius,r.NUMBER,10),_radiusScale:t.ensureInstanceOf(e.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:t.ensureTypedArg(e.position.distributionClamp,r.NUMBER,0)},this.velocity={_value:t.ensureInstanceOf(e.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.velocity.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.acceleration={_value:t.ensureInstanceOf(e.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:t.ensureInstanceOf(e.acceleration.spread,THREE.Vector3,new THREE.Vector3),_distribution:t.ensureTypedArg(e.acceleration.distribution,r.NUMBER,this.type),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.drag={_value:t.ensureTypedArg(e.drag.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.drag.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.wiggle={_value:t.ensureTypedArg(e.wiggle.value,r.NUMBER,0),_spread:t.ensureTypedArg(e.wiggle.spread,r.NUMBER,0)},this.rotation={_axis:t.ensureInstanceOf(e.rotation.axis,THREE.Vector3,new THREE.Vector3(0,1,0)),_axisSpread:t.ensureInstanceOf(e.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:t.ensureTypedArg(e.rotation.angle,r.NUMBER,0),_angleSpread:t.ensureTypedArg(e.rotation.angleSpread,r.NUMBER,0),_static:t.ensureTypedArg(e.rotation.static,r.BOOLEAN,!1),_center:t.ensureInstanceOf(e.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.maxAge={_value:t.ensureTypedArg(e.maxAge.value,r.NUMBER,2),_spread:t.ensureTypedArg(e.maxAge.spread,r.NUMBER,0)},this.color={_value:t.ensureArrayInstanceOf(e.color.value,THREE.Color,new THREE.Color),_spread:t.ensureArrayInstanceOf(e.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.opacity={_value:t.ensureArrayTypedArg(e.opacity.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.opacity.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.size={_value:t.ensureArrayTypedArg(e.size.value,r.NUMBER,1),_spread:t.ensureArrayTypedArg(e.size.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.angle={_value:t.ensureArrayTypedArg(e.angle.value,r.NUMBER,0),_spread:t.ensureArrayTypedArg(e.angle.spread,r.NUMBER,0),_randomise:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)},this.particleCount=t.ensureTypedArg(e.particleCount,r.NUMBER,100),this.duration=t.ensureTypedArg(e.duration,r.NUMBER,null),this.isStatic=t.ensureTypedArg(e.isStatic,r.BOOLEAN,!1),this.activeMultiplier=t.ensureTypedArg(e.activeMultiplier,r.NUMBER,1),this.direction=t.ensureTypedArg(e.direction,r.NUMBER,1),this.alive=t.ensureTypedArg(e.alive,r.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:t.ensureTypedArg(e.position.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.radius.randomise,r.BOOLEAN,!1),velocity:t.ensureTypedArg(e.velocity.randomise,r.BOOLEAN,!1),acceleration:t.ensureTypedArg(e.acceleration.randomise,r.BOOLEAN,!1)||t.ensureTypedArg(e.drag.randomise,r.BOOLEAN,!1),rotation:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),rotationCenter:t.ensureTypedArg(e.rotation.randomise,r.BOOLEAN,!1),size:t.ensureTypedArg(e.size.randomise,r.BOOLEAN,!1),color:t.ensureTypedArg(e.color.randomise,r.BOOLEAN,!1),opacity:t.ensureTypedArg(e.opacity.randomise,r.BOOLEAN,!1),angle:t.ensureTypedArg(e.angle.randomise,r.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"},this.updateMap)this.updateMap.hasOwnProperty(o)&&(this.updateCounts[this.updateMap[o]]=0,this.updateFlags[this.updateMap[o]]=!1,this._createGetterSetters(this[o],o));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,t.ensureValueOverLifetimeCompliance(this.color,i,i),t.ensureValueOverLifetimeCompliance(this.opacity,i,i),t.ensureValueOverLifetimeCompliance(this.size,i,i),t.ensureValueOverLifetimeCompliance(this.angle,i,i)},n.Emitter.constructor=n.Emitter,n.Emitter.prototype._createGetterSetters=function(e,t){"use strict";var r=this;for(var i in e)if(e.hasOwnProperty(i)){var o=i.replace("_","");Object.defineProperty(e,o,{get:function(e){return function(){return this[e]}}(i),set:function(e){return function(i){var o=r.updateMap[t],s=this[e],a=n.valueOverLifetimeLength;"_rotationCenter"===e?(r.updateFlags.rotationCenter=!0,r.updateCounts.rotationCenter=0):"_randomise"===e?r.resetFlags[o]=i:(r.updateFlags[o]=!0,r.updateCounts[o]=0),r.group._updateDefines(),this[e]=i,Array.isArray(s)&&n.utils.ensureValueOverLifetimeCompliance(r[t],a,a)}}(i)})}},n.Emitter.prototype._setBufferUpdateRanges=function(e){"use strict";this.attributeKeys=e,this.attributeCount=e.length;for(var t=this.attributeCount-1;t>=0;--t)this.bufferUpdateRanges[e[t]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},n.Emitter.prototype._calculatePPSValue=function(e){"use strict";var t=this.particleCount;this.duration?this.particlesPerSecond=t/(e<this.duration?e:this.duration):this.particlesPerSecond=t/e},n.Emitter.prototype._setAttributeOffset=function(e){this.attributeOffset=e,this.activationIndex=e,this.activationEnd=e+this.particleCount},n.Emitter.prototype._assignValue=function(e,t){"use strict";switch(e){case"position":this._assignPositionValue(t);break;case"velocity":case"acceleration":this._assignForceValue(t,e);break;case"size":case"opacity":this._assignAbsLifetimeValue(t,e);break;case"angle":this._assignAngleValue(t);break;case"params":this._assignParamsValue(t);break;case"rotation":this._assignRotationValue(t);break;case"color":this._assignColorValue(t)}},n.Emitter.prototype._assignPositionValue=function(e){"use strict";var t=n.distributions,r=n.utils,i=this.position,o=this.attributes.position,s=i._value,a=i._spread;switch(i._distribution){case t.BOX:r.randomVector3(o,e,s,a,i._spreadClamp);break;case t.SPHERE:r.randomVector3OnSphere(o,e,s,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case t.DISC:r.randomVector3OnDisc(o,e,s,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},n.Emitter.prototype._assignForceValue=function(e,t){"use strict";var r,i,o,s,a,l=n.distributions,d=n.utils,c=this[t],u=c._value,h=c._spread;switch(c._distribution){case l.BOX:d.randomVector3(this.attributes[t],e,u,h);break;case l.SPHERE:i=(r=this.attributes.position.typedArray.array)[a=3*e],o=r[a+1],s=r[a+2],d.randomDirectionVector3OnSphere(this.attributes[t],e,i,o,s,this.position._value,c._value.x,c._spread.x);break;case l.DISC:i=(r=this.attributes.position.typedArray.array)[a=3*e],o=r[a+1],s=r[a+2],d.randomDirectionVector3OnDisc(this.attributes[t],e,i,o,s,this.position._value,c._value.x,c._spread.x)}if("acceleration"===t){var p=d.clamp(d.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*e+3]=p}},n.Emitter.prototype._assignAbsLifetimeValue=function(e,t){"use strict";var r,i=this.attributes[t].typedArray,o=this[t],s=n.utils;s.arrayValuesAreEqual(o._value)&&s.arrayValuesAreEqual(o._spread)?(r=Math.abs(s.randomFloat(o._value[0],o._spread[0])),i.setVec4Components(e,r,r,r,r)):i.setVec4Components(e,Math.abs(s.randomFloat(o._value[0],o._spread[0])),Math.abs(s.randomFloat(o._value[1],o._spread[1])),Math.abs(s.randomFloat(o._value[2],o._spread[2])),Math.abs(s.randomFloat(o._value[3],o._spread[3])))},n.Emitter.prototype._assignAngleValue=function(e){"use strict";var t,r=this.attributes.angle.typedArray,i=this.angle,o=n.utils;o.arrayValuesAreEqual(i._value)&&o.arrayValuesAreEqual(i._spread)?(t=o.randomFloat(i._value[0],i._spread[0]),r.setVec4Components(e,t,t,t,t)):r.setVec4Components(e,o.randomFloat(i._value[0],i._spread[0]),o.randomFloat(i._value[1],i._spread[1]),o.randomFloat(i._value[2],i._spread[2]),o.randomFloat(i._value[3],i._spread[3]))},n.Emitter.prototype._assignParamsValue=function(e){"use strict";this.attributes.params.typedArray.setVec4Components(e,this.isStatic?1:0,0,Math.abs(n.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),n.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},n.Emitter.prototype._assignRotationValue=function(e){"use strict";this.attributes.rotation.typedArray.setVec3Components(e,n.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),n.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(e,this.rotation._center)},n.Emitter.prototype._assignColorValue=function(e){"use strict";n.utils.randomColorAsHex(this.attributes.color,e,this.color._value,this.color._spread)},n.Emitter.prototype._resetParticle=function(e){"use strict";for(var t,r,i=this.resetFlags,o=this.updateFlags,n=this.updateCounts,s=this.attributeKeys,a=this.attributeCount-1;a>=0;--a)r=o[t=s[a]],!0!==i[t]&&!0!==r||(this._assignValue(t,e),this._updateAttributeUpdateRange(t,e),!0===r&&n[t]===this.particleCount?(o[t]=!1,n[t]=0):1==r&&++n[t])},n.Emitter.prototype._updateAttributeUpdateRange=function(e,t){"use strict";var r=this.bufferUpdateRanges[e];r.min=Math.min(t,r.min),r.max=Math.max(t,r.max)},n.Emitter.prototype._resetBufferRanges=function(){"use strict";for(var e,t=this.bufferUpdateRanges,r=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;i>=0;--i)t[e=r[i]].min=Number.POSITIVE_INFINITY,t[e].max=Number.NEGATIVE_INFINITY},n.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},n.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},n.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},n.Emitter.prototype._checkParticleAges=function(e,t,r,i){"use strict";for(var o,n,s,a,l=t-1;l>=e;--l)0!==(a=r[o=4*l])&&(s=r[o+1],n=r[o+2],1===this.direction?(s+=i)>=n&&(s=0,a=0,this._decrementParticleCount()):(s-=i)<=0&&(s=n,a=0,this._decrementParticleCount()),r[o]=a,r[o+1]=s,this._updateAttributeUpdateRange("params",l))},n.Emitter.prototype._activateParticles=function(e,t,r,i){"use strict";for(var o,n,s=this.direction,a=e;a<t;++a)0!=r[o=4*a]&&1!==this.particleCount||(this._incrementParticleCount(),r[o]=1,this._resetParticle(a),n=i*(a-e),r[o+1]=-1===s?r[o+2]-n:n,this._updateAttributeUpdateRange("params",a))},n.Emitter.prototype.tick=function(e){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var t=this.attributeOffset,r=t+this.particleCount,i=this.paramsArray,o=this.particlesPerSecond*this.activeMultiplier*e,n=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(t,r,i,e),!1!==this.alive){if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var s=1===this.particleCount?n:0|n,a=Math.min(s+o,this.activationEnd),l=a-this.activationIndex|0,d=l>0?e/l:0;this._activateParticles(s,a,i,d),this.activationIndex+=o,this.activationIndex>r&&(this.activationIndex=t),this.age+=e}else this.age=0}},n.Emitter.prototype.reset=function(e){"use strict";if(this.age=0,this.alive=!1,!0===e){for(var t,r=this.attributeOffset,i=r+this.particleCount,o=this.paramsArray,n=this.attributes.params.bufferAttribute,s=i-1;s>=r;--s)o[t=4*s]=0,o[t+1]=0;n.updateRange.offset=0,n.updateRange.count=-1,n.needsUpdate=!0}return this},n.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},n.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},n.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this}},function(e,t,r){const i='<a-scene environment="preset: forest; seed: 123; shadowSize: 5">\n  \x3c!-- <require path="/Users/ngoke/Code/aframe-super-hot-loader/example/src/templates/assets.html"> --\x3e\n<a-assets>\n</a-assets>\n\x3c!-- </require> --\x3e\n\n  \x3c!-- Box. --\x3e\n  <a-entity geometry="primitive: box" material="color: #4CC3D9" position="-1 0.5 -3" rotation="0 45 0" shadow></a-entity>\n\n  \x3c!-- Sphere. --\x3e\n  <a-entity geometry="primitive: sphere; radius: 1.25" material="color: #EF2D5E" position="0 1.25 -5" shadow></a-entity>\n\n  \x3c!-- Cylinder. --\x3e\n  <a-entity geometry="primitive: cylinder; radius: 0.5; height: 1.5" material="color: #FFC65D" position="1 0.75 -3" shadow spin></a-entity>\n</a-scene>\n';document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("app");e||((e=document.createElement("div")).id="app",document.body.appendChild(e));e.innerHTML=i});{const t=r(10).DiffDOM;if(e.hot.accept(),e.hot.data&&e.hot.data.oldHtml){const r=e.hot.data.oldHtml,o=new t,n=document.createElement("div");n.innerHTML=r;const s=document.createElement("div");s.innerHTML=i;const a=o.diff(n,s);o.apply(document.getElementById("app"),a)}e.hot.dispose(e=>{e.oldHtml=i})}},function(e,t,r){"use strict";function i(e,t,r){let o;return"#text"===e.nodeName?o=r.document.createTextNode(e.data):"#comment"===e.nodeName?o=r.document.createComment(e.data):("svg"===e.nodeName||t?(o=r.document.createElementNS("http://www.w3.org/2000/svg",e.nodeName),t=!0):o=r.document.createElement(e.nodeName),e.attributes&&Object.entries(e.attributes).forEach(([e,t])=>o.setAttribute(e,t)),e.childNodes&&e.childNodes.forEach(e=>o.appendChild(i(e,t,r))),r.valueDiffing&&(e.value&&(o.value=e.value),e.checked&&(o.checked=e.checked),e.selected&&(o.selected=e.selected))),o}function o(e,t){for(t=t.slice();t.length>0;){if(!e.childNodes)return!1;const r=t.splice(0,1)[0];e=e.childNodes[r]}return e}function n(e,t,r){let n,s,a,l,d,c=o(e,t[r._const.route]);const u={diff:t,node:c};if(r.preDiffApply(u))return!0;switch(t[r._const.action]){case r._const.addAttribute:if(!c||!c.setAttribute)return!1;c.setAttribute(t[r._const.name],t[r._const.value]);break;case r._const.modifyAttribute:if(!c||!c.setAttribute)return!1;c.setAttribute(t[r._const.name],t[r._const.newValue]),"INPUT"===c.nodeName&&"value"===t[r._const.name]&&(c.value=t[r._const.oldValue]);break;case r._const.removeAttribute:if(!c||!c.removeAttribute)return!1;c.removeAttribute(t[r._const.name]);break;case r._const.modifyTextElement:if(!c||3!==c.nodeType)return!1;r.textDiff(c,c.data,t[r._const.oldValue],t[r._const.newValue]);break;case r._const.modifyValue:if(!c||void 0===c.value)return!1;c.value=t[r._const.newValue];break;case r._const.modifyComment:if(!c||void 0===c.data)return!1;r.textDiff(c,c.data,t[r._const.oldValue],t[r._const.newValue]);break;case r._const.modifyChecked:if(!c||void 0===c.checked)return!1;c.checked=t[r._const.newValue];break;case r._const.modifySelected:if(!c||void 0===c.selected)return!1;c.selected=t[r._const.newValue];break;case r._const.replaceElement:c.parentNode.replaceChild(i(t[r._const.newValue],"http://www.w3.org/2000/svg"===c.namespaceURI,r),c);break;case r._const.relocateGroup:(l=Array(...new Array(t.groupLength)).map(()=>c.removeChild(c.childNodes[t[r._const.from]]))).forEach((e,i)=>{0===i&&(s=c.childNodes[t[r._const.to]]),c.insertBefore(e,s||null)});break;case r._const.removeElement:c.parentNode.removeChild(c);break;case r._const.addElement:d=(a=t[r._const.route].slice()).splice(a.length-1,1)[0],(c=o(e,a)).insertBefore(i(t[r._const.element],"http://www.w3.org/2000/svg"===c.namespaceURI,r),c.childNodes[d]||null);break;case r._const.removeTextElement:if(!c||3!==c.nodeType)return!1;c.parentNode.removeChild(c);break;case r._const.addTextElement:if(d=(a=t[r._const.route].slice()).splice(a.length-1,1)[0],n=r.document.createTextNode(t[r._const.value]),!(c=o(e,a))||!c.childNodes)return!1;c.insertBefore(n,c.childNodes[d]||null);break;default:console.log("unknown action")}return u.newNode=n,r.postDiffApply(u),!0}function s(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}function a(e,t,r){t.length||(t=[t]),(t=t.slice()).reverse(),t.forEach(t=>{!function(e,t,r){switch(t[r._const.action]){case r._const.addAttribute:t[r._const.action]=r._const.removeAttribute,n(e,t,r);break;case r._const.modifyAttribute:s(t,r._const.oldValue,r._const.newValue),n(e,t,r);break;case r._const.removeAttribute:t[r._const.action]=r._const.addAttribute,n(e,t,r);break;case r._const.modifyTextElement:case r._const.modifyValue:case r._const.modifyComment:case r._const.modifyChecked:case r._const.modifySelected:case r._const.replaceElement:s(t,r._const.oldValue,r._const.newValue),n(e,t,r);break;case r._const.relocateGroup:s(t,r._const.from,r._const.to),n(e,t,r);break;case r._const.removeElement:t[r._const.action]=r._const.addElement,n(e,t,r);break;case r._const.addElement:t[r._const.action]=r._const.removeElement,n(e,t,r);break;case r._const.removeTextElement:t[r._const.action]=r._const.addTextElement,n(e,t,r);break;case r._const.addTextElement:t[r._const.action]=r._const.removeTextElement,n(e,t,r);break;default:console.log("unknown action")}}(e,t,r)})}r.r(t);class l{constructor(e={}){Object.entries(e).forEach(([e,t])=>this[e]=t)}toString(){return JSON.stringify(this)}setValue(e,t){return this[e]=t,this}}function d(e){const t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(`${e.nodeName}.${e.attributes.class.replace(/ /g,".")}`),e.attributes.id&&t.push(`${e.nodeName}#${e.attributes.id}`))),t}function c(e){const t={},r={};return e.forEach(e=>{d(e).forEach(e=>{const i=e in t;i||e in r?i&&(delete t[e],r[e]=!0):t[e]=!0})}),t}function u(e,t){const r=c(e),i=c(t),o={};return Object.keys(r).forEach(e=>{i[e]&&(o[e]=!0)}),o}function h(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(h)}function p(e,t){if(!["nodeName","value","checked","selected","data"].every(r=>e[r]===t[r]))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){const r=Object.keys(e.attributes),i=Object.keys(t.attributes);if(r.length!==i.length)return!1;if(!r.every(r=>e.attributes[r]===t.attributes[r]))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every((e,r)=>p(e,t.childNodes[r])))return!1}return!0}function f(e,t,r,i,o){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!o||e.data===t.data;if(e.nodeName in r)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(`${e.nodeName}#${e.attributes.id}`in r)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class){if(`${e.nodeName}.${e.attributes.class.replace(/ /g,".")}`in r)return!0}}if(i)return!0;const n=e.childNodes?e.childNodes.slice().reverse():[],s=t.childNodes?t.childNodes.slice().reverse():[];if(n.length!==s.length)return!1;if(o)return n.every((e,t)=>e.nodeName===s[t].nodeName);{const e=u(n,s);return n.every((t,r)=>f(t,s[r],e,!0,!0))}}function g(e){return JSON.parse(JSON.stringify(e))}function m(e,t,r,i){let o=0,n=[];const s=e.length,a=t.length,l=Array(...new Array(s+1)).map(()=>[]),c=u(e,t);let h=s===a;h&&e.some((e,r)=>{const i=d(e),o=d(t[r]);return i.length!==o.length?(h=!1,!0):(i.some((e,t)=>{if(e!==o[t])return h=!1,!0}),!h||void 0)});for(let d=0;d<s;d++){const s=e[d];for(let e=0;e<a;e++){const a=t[e];r[d]||i[e]||!f(s,a,c,h)?l[d+1][e+1]=0:(l[d+1][e+1]=l[d][e]?l[d][e]+1:1,l[d+1][e+1]>=o&&(o=l[d+1][e+1],n=[d+1,e+1]))}}return 0!==o&&{oldValue:n[0]-o,newValue:n[1]-o,length:o}}function y(e,t){return Array(...new Array(e)).map(()=>t)}class v{constructor(){this.list=[]}add(e){this.list.push(...e)}forEach(e){this.list.forEach(t=>e(t))}}function E(e,t){let r,i,o=e;for(t=t.slice();t.length>0;){if(!o.childNodes)return!1;i=t.splice(0,1)[0],r=o,o=o.childNodes[i]}return{node:o,parentNode:r,nodeIndex:i}}function A(e,t,r){return t.forEach(t=>{!function(e,t,r){const i=E(e,t[r._const.route]);let o=i.node;const n=i.parentNode,s=i.nodeIndex,a=[],l={diff:t,node:o};if(r.preDiffApply(l))return!0;let d,c,u,h;switch(t[r._const.action]){case r._const.addAttribute:o.attributes||(o.attributes={}),o.attributes[t[r._const.name]]=t[r._const.value],"checked"===t[r._const.name]?o.checked=!0:"selected"===t[r._const.name]?o.selected=!0:"INPUT"===o.nodeName&&"value"===t[r._const.name]&&(o.value=t[r._const.value]);break;case r._const.modifyAttribute:o.attributes[t[r._const.name]]=t[r._const.newValue];break;case r._const.removeAttribute:delete o.attributes[t[r._const.name]],0===Object.keys(o.attributes).length&&delete o.attributes,"checked"===t[r._const.name]?o.checked=!1:"selected"===t[r._const.name]?delete o.selected:"INPUT"===o.nodeName&&"value"===t[r._const.name]&&delete o.value;break;case r._const.modifyTextElement:o.data=t[r._const.newValue];break;case r._const.modifyValue:o.value=t[r._const.newValue];break;case r._const.modifyComment:o.data=t[r._const.newValue];break;case r._const.modifyChecked:o.checked=t[r._const.newValue];break;case r._const.modifySelected:o.selected=t[r._const.newValue];break;case r._const.replaceElement:(d=g(t[r._const.newValue])).outerDone=!0,d.innerDone=!0,d.valueDone=!0,n.childNodes[s]=d;break;case r._const.relocateGroup:(c=o.childNodes.splice(t[r._const.from],t.groupLength).reverse()).forEach(e=>o.childNodes.splice(t[r._const.to],0,e)),o.subsets&&o.subsets.forEach(e=>{if(t[r._const.from]<t[r._const.to]&&e.oldValue<=t[r._const.to]&&e.oldValue>t[r._const.from]){e.oldValue-=t.groupLength;const i=e.oldValue+e.length-t[r._const.to];i>0&&(a.push({oldValue:t[r._const.to]+t.groupLength,newValue:e.newValue+e.length-i,length:i}),e.length-=i)}else if(t[r._const.from]>t[r._const.to]&&e.oldValue>t[r._const.to]&&e.oldValue<t[r._const.from]){e.oldValue+=t.groupLength;const i=e.oldValue+e.length-t[r._const.to];i>0&&(a.push({oldValue:t[r._const.to]+t.groupLength,newValue:e.newValue+e.length-i,length:i}),e.length-=i)}else e.oldValue===t[r._const.from]&&(e.oldValue=t[r._const.to])});break;case r._const.removeElement:n.childNodes.splice(s,1),n.subsets&&n.subsets.forEach(e=>{e.oldValue>s?e.oldValue-=1:e.oldValue===s?e.delete=!0:e.oldValue<s&&e.oldValue+e.length>s&&(e.oldValue+e.length-1===s?e.length--:(a.push({newValue:e.newValue+s-e.oldValue,oldValue:s,length:e.length-s+e.oldValue-1}),e.length=s-e.oldValue))}),o=n;break;case r._const.addElement:u=t[r._const.route].slice(),h=u.splice(u.length-1,1)[0],o=E(e,u).node,(d=g(t[r._const.element])).outerDone=!0,d.innerDone=!0,d.valueDone=!0,o.childNodes||(o.childNodes=[]),h>=o.childNodes.length?o.childNodes.push(d):o.childNodes.splice(h,0,d),o.subsets&&o.subsets.forEach(e=>{if(e.oldValue>=h)e.oldValue+=1;else if(e.oldValue<h&&e.oldValue+e.length>h){const t=e.oldValue+e.length-h;a.push({newValue:e.newValue+e.length-t,oldValue:h+1,length:t}),e.length-=t}});break;case r._const.removeTextElement:n.childNodes.splice(s,1),"TEXTAREA"===n.nodeName&&delete n.value,n.subsets&&n.subsets.forEach(e=>{e.oldValue>s?e.oldValue-=1:e.oldValue===s?e.delete=!0:e.oldValue<s&&e.oldValue+e.length>s&&(e.oldValue+e.length-1===s?e.length--:(a.push({newValue:e.newValue+s-e.oldValue,oldValue:s,length:e.length-s+e.oldValue-1}),e.length=s-e.oldValue))}),o=n;break;case r._const.addTextElement:u=t[r._const.route].slice(),h=u.splice(u.length-1,1)[0],(d={}).nodeName="#text",d.data=t[r._const.value],(o=E(e,u).node).childNodes||(o.childNodes=[]),h>=o.childNodes.length?o.childNodes.push(d):o.childNodes.splice(h,0,d),"TEXTAREA"===o.nodeName&&(o.value=t[r._const.newValue]),o.subsets&&o.subsets.forEach(e=>{if(e.oldValue>=h&&(e.oldValue+=1),e.oldValue<h&&e.oldValue+e.length>h){const t=e.oldValue+e.length-h;a.push({newValue:e.newValue+e.length-t,oldValue:h+1,length:t}),e.length-=t}});break;default:console.log("unknown action")}o.subsets&&(o.subsets=o.subsets.filter(e=>!e.delete&&e.oldValue!==e.newValue),a.length&&(o.subsets=o.subsets.concat(a))),l.newNode=d,r.postDiffApply(l)}(e,t,r)}),!0}function x(e,t){const r={};if(r.nodeName=e.nodeName,"#text"===r.nodeName||"#comment"===r.nodeName)r.data=e.data;else{if(e.attributes&&e.attributes.length>0){r.attributes={},Array.prototype.slice.call(e.attributes).forEach(e=>r.attributes[e.name]=e.value)}if("TEXTAREA"===r.nodeName)r.value=e.value;else if(e.childNodes&&e.childNodes.length>0){r.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(e=>r.childNodes.push(x(e,t)))}t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?r.checked=e.checked:void 0!==e.value&&(r.value=e.value),void 0!==e.selected&&(r.selected=e.selected))}return r}class b{constructor(e,t,r){this.options=r,this.t1=x(e,this.options),this.t2=x(t,this.options),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=x(e,this.options),this.t2Orig=x(t,this.options)),this.tracker=new v}init(){return this.findDiffs(this.t1,this.t2)}findDiffs(e,t){let r;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error(`surpassed diffcap:${JSON.stringify(this.t1Orig)} -> ${JSON.stringify(this.t2Orig)}`);0===(r=this.findNextDiff(e,t,[])).length&&(p(e,t)||(this.foundAll?(console.error("Could not find remaining diffs!"),console.log({t1:e,t2:t})):(this.foundAll=!0,h(e),r=this.findNextDiff(e,t,[])))),r.length>0&&(this.foundAll=!1,this.tracker.add(r),A(e,r,this.options))}while(r.length>0);return this.tracker.list}findNextDiff(e,t,r){let i,o;if(this.options.maxDepth&&r.length>this.options.maxDepth)return[];if(!e.outerDone){if(i=this.findOuterDiff(e,t,r),this.filterOuterDiff&&(o=this.filterOuterDiff(e,t,i))&&(i=o),i.length>0)return e.outerDone=!0,i;e.outerDone=!0}if(!e.innerDone){if((i=this.findInnerDiff(e,t,r)).length>0)return i;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if((i=this.findValueDiff(e,t,r)).length>0)return e.valueDone=!0,i;e.valueDone=!0}return[]}findOuterDiff(e,t,r){const i=[];let o,n,s,a,d,c;if(e.nodeName!==t.nodeName)return[(new l).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,g(e)).setValue(this.options._const.newValue,g(t)).setValue(this.options._const.route,r)];if(r.length&&this.options.maxChildCount&&e.childNodes&&t.childNodes&&e.childNodes.length>this.options.maxChildCount&&t.childNodes.length>this.options.maxChildCount){const i=e.childNodes.length<t.childNodes.length?e.childNodes.length:t.childNodes.length;let o=0,n=0;for(;o<this.options.maxChildDiffCount&&n<i;)p(e.childNodes[n],t.childNodes[n])||o++,n++;if(o===this.options.maxChildDiffCount)return[(new l).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,g(e)).setValue(this.options._const.newValue,g(t)).setValue(this.options._const.route,r)]}if(e.data!==t.data)return"#text"===e.nodeName?[(new l).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,r).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[(new l).setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,r).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(n=e.attributes?Object.keys(e.attributes).sort():[],s=t.attributes?Object.keys(t.attributes).sort():[],a=n.length,c=0;c<a;c++)o=n[c],-1===(d=s.indexOf(o))?i.push((new l).setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,r).setValue(this.options._const.name,o).setValue(this.options._const.value,e.attributes[o])):(s.splice(d,1),e.attributes[o]!==t.attributes[o]&&i.push((new l).setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,r).setValue(this.options._const.name,o).setValue(this.options._const.oldValue,e.attributes[o]).setValue(this.options._const.newValue,t.attributes[o])));for(a=s.length,c=0;c<a;c++)o=s[c],i.push((new l).setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,r).setValue(this.options._const.name,o).setValue(this.options._const.value,t.attributes[o]));return i}findInnerDiff(e,t,r){const i=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?function(e,t){const r=e.childNodes?e.childNodes:[],i=t.childNodes?t.childNodes:[],o=y(r.length,!1),n=y(i.length,!1),s=[];let a=!0;const l=function(){return arguments[1]},d=e=>{o[a.oldValue+e]=!0,n[a.newValue+e]=!0};for(;a;)(a=m(r,i,o,n))&&(s.push(a),Array(...new Array(a.length)).map(l).forEach(e=>d(e)));return e.subsets=s,e.subsetsAge=100,s}(e,t):[],o=e.childNodes?e.childNodes:[],n=t.childNodes?t.childNodes:[];let s,a=[],d=0;if(i.length>0&&(a=this.attemptGroupRelocation(e,t,i,r)).length>0)return a;const c=Math.max(o.length,n.length);o.length!==n.length&&(s=!0);for(let e=0;e<c;e+=1){const t=o[e],i=n[e];s&&(t&&!i?"#text"===t.nodeName?(a.push((new l).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,r.concat(d)).setValue(this.options._const.value,t.data)),d-=1):(a.push((new l).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,r.concat(d)).setValue(this.options._const.element,g(t))),d-=1):i&&!t&&("#text"===i.nodeName?a.push((new l).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,r.concat(d)).setValue(this.options._const.value,i.data)):a.push((new l).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,r.concat(d)).setValue(this.options._const.element,g(i))))),t&&i&&(a=a.concat(this.findNextDiff(t,i,r.concat(d)))),d+=1}return e.innerDone=!0,a}attemptGroupRelocation(e,t,r,i){const o=function(e,t,r){const i=e.childNodes?y(e.childNodes.length,!0):[],o=t.childNodes?y(t.childNodes.length,!0):[];let n=0;return r.forEach(e=>{const t=e.oldValue+e.length,r=e.newValue+e.length;for(let r=e.oldValue;r<t;r+=1)i[r]=n;for(let t=e.newValue;t<r;t+=1)o[t]=n;n+=1}),{gaps1:i,gaps2:o}}(e,t,r),n=o.gaps1,s=o.gaps2;let a,d,c,u,h,p,m=Math.min(n.length,s.length);const v=[];for(let o=0,y=0;o<m;y+=1,o+=1)if(!0===n[o])if("#text"===(u=e.childNodes[y]).nodeName){if("#text"===t.childNodes[o].nodeName&&u.data!==t.childNodes[o].data){for(p=y;e.childNodes.length>p+1&&"#text"===e.childNodes[p+1].nodeName;)if(p+=1,t.childNodes[o].data===e.childNodes[p].data){h=!0;break}if(!h)return v.push((new l).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,i.concat(o)).setValue(this.options._const.oldValue,u.data).setValue(this.options._const.newValue,t.childNodes[o].data)),v}v.push((new l).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,i.concat(o)).setValue(this.options._const.value,u.data)),n.splice(o,1),m=Math.min(n.length,s.length),o-=1}else v.push((new l).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,i.concat(o)).setValue(this.options._const.element,g(u))),n.splice(o,1),m=Math.min(n.length,s.length),o-=1;else if(!0===s[o])"#text"===(u=t.childNodes[o]).nodeName?(v.push((new l).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,i.concat(o)).setValue(this.options._const.value,u.data)),n.splice(o,0,!0),m=Math.min(n.length,s.length),y-=1):(v.push((new l).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,i.concat(o)).setValue(this.options._const.element,g(u))),n.splice(o,0,!0),m=Math.min(n.length,s.length),y-=1);else if(n[o]!==s[o]){if(v.length>0)return v;if(c=r[n[o]],(d=Math.min(c.newValue,e.childNodes.length-c.length))!==c.oldValue){a=!1;for(let t=0;t<c.length;t+=1)f(e.childNodes[d+t],e.childNodes[c.oldValue+t],[],!1,!0)||(a=!0);if(a)return[(new l).setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",c.length).setValue(this.options._const.from,c.oldValue).setValue(this.options._const.to,d).setValue(this.options._const.route,i)]}}return v}findValueDiff(e,t,r){const i=[];return e.selected!==t.selected&&i.push((new l).setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,r)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&i.push((new l).setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,r)),e.checked!==t.checked&&i.push((new l).setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,r)),i}}const _={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,maxChildDiffCount:3,valueDiffing:!0,textDiff(e,t,r,i){e.data=i},preVirtualDiffApply(){},postVirtualDiffApply(){},preDiffApply(){},postDiffApply(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(!window||!window.document)&&window.document};class C{constructor(e={}){if(this.options=e,Object.entries(_).forEach(([e,t])=>{Object.prototype.hasOwnProperty.call(this.options,e)||(this.options[e]=t)}),!this.options._const){const e=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this.options._const={},this.options.compress?e.forEach((e,t)=>this.options._const[e]=t):e.forEach(e=>this.options._const[e]=e)}this.DiffFinder=b}apply(e,t){return function(e,t,r){return t.every(t=>n(e,t,r))}(e,t,this.options)}undo(e,t){return a(e,t,this.options)}diff(e,t){return new this.DiffFinder(e,t,this.options).init()}}class T{constructor(e={}){this.pad="   ",this.padding="",this.tick=1,this.messages=[];const t=(e,t)=>{const r=e[t];e[t]=((...i)=>{this.fin(t,Array.prototype.slice.call(i));const o=r.apply(e,i);return this.fout(t,o),o})};for(let r in e)"function"==typeof e[r]&&t(e,r);this.log(" TRACELOG START")}fin(e,t){this.padding+=this.pad,this.log(`> entering ${e}`,t)}fout(e,t){this.log("< generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)}format(e,t){return`${function(e){for(e=`${e}`;e.length<4;)e=`0${e}`;return e}(t)}> ${this.padding}${e}`}log(){let e=Array.prototype.slice.call(arguments);const t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?`[${e.map(t).join(",")}]`:e.toString()||e.valueOf()||"<unknown>":"<falsey>"};e=e.map(t).join(", "),this.messages.push(this.format(e,this.tick++))}toString(){let e="";for(;e.length<=this.padding.length+this.pad.length;)e+="   ";let t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,`${this.messages.join("\n")}\n${e}`}}r.d(t,"DiffDOM",function(){return C}),r.d(t,"TraceLogger",function(){return T})}]);